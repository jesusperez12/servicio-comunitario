{"version":3,"sources":["validateCertificate.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"validateCertificate.js","sourcesContent":["var ValidateCertificate = (function(){\n\n    var el = {\n        formValidateCertificate: '#form-validate-certificate',\n        preloadValidateResult: '#preload-validate-result',\n        validateResult: '#validate-result',\n        validateForm: '#validate-form',\n        inputCertificateCode: '#certificate_code',\n        btnBackValidateForm: '#btn-back-validate-form',\n        previewNumRegister: '#preview-num-register',\n        previewNamePrestador: '#preview-name-prestador',\n        previewGroup: '#preview-group',\n        previewPeriodo: '#preview-periodo',\n        previewNameProject: '#preview-name-project',\n        previewDates: '#preview-dates',\n    };\n\n    var dom = {\n        formValidateCertificate: $(el.formValidateCertificate),\n        preloadValidateResult: $(el.preloadValidateResult),\n        validateResult: $(el.validateResult),\n        validateForm: $(el.validateForm),\n        inputCertificateCode: $(el.inputCertificateCode),\n        btnBackValidateForm: $(el.btnBackValidateForm),\n        previewNumRegister: $(el.previewNumRegister),\n        previewNamePrestador: $(el.previewNamePrestador),\n        previewGroup: $(el.previewGroup),\n        previewPeriodo: $(el.previewPeriodo),\n        previewNameProject: $(el.previewNameProject),\n        previewDates: $(el.previewDates),\n    };\n\n    var validators = {\n        formValidateCertificate: function () {\n            return dom.formValidateCertificate.validate();\n        }\n    };\n\n    var events = {\n        clearFormValidateCertificate: function (evt) {\n            dom.formValidateCertificate.trigger('reset');\n            validators.formValidateCertificate().resetForm();\n        },\n        validating: function (evt) {\n            if (dom.validateForm.is(':visible')) {\n                dom.validateForm.hide();\n            }\n            if (dom.preloadValidateResult.is(\":hidden\")) {\n                dom.preloadValidateResult.show();\n            }\n            if (dom.validateResult.is(\":visible\")) {\n                dom.validateResult.hide();\n            }\n        },\n        loaded: function (evt) {\n            if (dom.preloadValidateResult.is(\":visible\")) {\n                dom.preloadValidateResult.hide();\n            }\n            if (dom.validateResult.is(\":hidden\")) {\n                dom.validateResult.fadeIn();\n            }\n        },\n        restoreForm: function (evt) {\n            if (dom.validateResult.is(\":visible\")) {\n                dom.validateResult.fadeOut(500, function () {\n                    if (dom.validateForm.is(':hidden')) {\n                        dom.validateForm.fadeIn();\n                    }\n                });\n                dom.validateForm.trigger('clearFormValidateCertificate');\n                dom.validateResult.trigger('loadData', false);\n            }\n        },\n        loadData: function (evt, data) {\n            if (data) {\n                dom.previewNumRegister.html(`<b>${data.code}</b> <i class=\"fa fa-check-circle text-green\"></i>`);\n                dom.previewNamePrestador.html(`${data.firstname} ${data.primary_lastname}`);\n                dom.previewGroup.html(`Grupo NÂº ${data.grupo.grupo}`);\n                dom.previewPeriodo.html(`${data.periodo.corte}`);\n                dom.previewNameProject.html(`<span style=\"font-style:italic;\">${data.proyecto.nombre_proyecto.toUpperCase()}</span>`);\n                dom.previewDates.html(`<b>${moment(data.proyecto.bundle_pivot.created_at).format(\"DD/MM/YYYY\")}</b> al <b>${moment(data.proyecto.bundle_pivot.finalized_at).format(\"DD/MM/YYYY\")}</b>`);\n            } else {\n                dom.previewNumRegister.html(`-`);\n                dom.previewNamePrestador.html(`-`);\n                dom.previewGroup.html(`-`);\n                dom.previewPeriodo.html(`-`);\n                dom.previewNameProject.html(`-`);\n                dom.previewDates.html(`-`);\n            }\n            $(document).trigger('loaded');\n        }\n    };\n\n    var subscribeEvents = function () {\n        dom.formValidateCertificate.on('clearFormValidateCertificate', events.clearFormValidateCertificate);\n        dom.validateResult.on('loadData', events.loadData);\n        dom.btnBackValidateForm.on('click', events.restoreForm);\n        $(document).on('validating', events.validating);\n        $(document).on('loaded', events.loaded);\n    }\n\n    var validate = {\n        callback: function (form) {\n            Pace.track(function () {\n                $(document).trigger('validating');\n                var data = $(form).serialize();\n                $.ajax({\n                    url: '/admin/certificate/validate',\n                    data: data,\n                    type: 'POST',\n                    dataType: 'JSON',\n                })\n                .done(function(rs) {\n                    if (rs.response == 'ok') {\n                        dom.validateResult.trigger('loadData', rs.data);\n                        dom.formValidateCertificate.trigger('clearFormValidateCertificate');\n                    }\n                })\n                .fail(function(jqXHR) {\n                    Utils.displayErrors(jqXHR);\n                    dom.validateResult.trigger('loadData', false);\n                })\n            });\n        },\n        rules: {\n            ci: {\n                required: true,\n                number: true,\n                maxlength: 8,\n                minlength: 7\n            },\n            certificate_code: {\n                required: true\n            }\n        }\n    }\n\n    var initFormFun = function () {\n        // Activate link\n        var url = $(\"#url-active\").data(\"url-active\");\n        global.url_active(url);\n\n        dom.inputCertificateCode.inputmask('SC120-999{1,20}-9');\n    }\n\n    var initializer = function () {\n        subscribeEvents();\n        initFormFun();\n        Utils.initValidateForm(dom.formValidateCertificate.get(0), validate.callback, validate.rules);\n    }\n\n    return {\n        initializer: initializer\n    }\n})()\n$(document).ready(function () {\n    ValidateCertificate.initializer();\n});"]}