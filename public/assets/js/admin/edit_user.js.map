{"version":3,"sources":["edit_user.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"edit_user.js","sourcesContent":["$(document).ready(function() {\n\n    // USERS FORM VALIDATE\n    $(\"#form-edit-user\").validate({\n        submitHandler: function(form) {\n            var id = form.user_id.value;\n            var data = $(form).serialize();\n            $.ajax({\n                url: '/admin/user/edit/' + id,\n                data: data,\n                type: 'POST',\n                dataType: 'json',\n                success: function(json) {\n                    if(json.response == 'ok') {\n                        $(\"#editUser\").modal(\"hide\");\n                        table = $(\"#table-list-users\").DataTable();\n                        table.ajax.reload();\n\n                        noty({\n                            text: \"Se ha guardado correctamente...\",\n                            type: 'success',\n                            theme: \"relax\",\n                            timeout: 1500, // [integer|boolean] delay for closing event in milliseconds. Set false for sticky notifications\n                            progressBar: true, // [boolean] - displays a progress bar\n                            template: '<div class=\"noty_message\"><span class=\"fa fa-check\"></span> <span class=\"noty_text\"></span><div class=\"noty_close\"></div></div>',\n                            animation: {\n                                open: 'animated bounceInDown', // Animate.css class names\n                                close: 'animated bounceOutUp', // Animate.css class names\n                                easing: 'swing', // unavailable - no need\n                                speed: 500 // unavailable - no need\n                            }\n                        })\n                    }\n                },\n                error: function(jqXHR) {\n                    displayErrors(jqXHR);\n                }\n            })\n        },\n        rules: {\n            ci: {\n                required: true,\n                number: true,\n                maxlength: 8,\n                minlength: 7\n            },\n            firstname: {\n                required: true,\n                lettersOnly: true\n            },\n            middlename: {\n                required: false,\n                lettersOnly: true\n            },\n            primary_lastname: {\n                required: true,\n                lettersOnly: true\n            },\n            second_lastname: {\n                required: false,\n                lettersOnly: true\n            },\n            address: {\n                required: true,\n                lettersOnly: true\n            },\n            locality: {\n                required: true,\n                lettersOnly: true\n            },\n            province: {\n                required: true,\n                lettersOnly: true\n            },\n            date_birth: {\n                required: false,\n                validDate: true\n            },\n            'phones[]': {\n                required: true,\n                maxlength: 7,\n                minlength: 7\n            },\n            speciality: {\n                required: false,\n                lettersOnly: true\n            },\n            email: {\n                required: true,\n                isEmail: true\n            },\n            role_id: {\n                required: true\n            },\n            status: {\n                required: true\n            },\n            password: {\n                required: false,\n                minlength: 8\n            }\n        }\n    })\n\n    // Plus phones\n    $(\"#plus-phone\").on('click', function(e) {\n        e.preventDefault();\n        var el = $(\"#element-phone\").clone();\n        el.find('select').val(1);\n        var btn_remove = '<div class=\"row element-phone-cloned\">'\n        + '<div class=\"col-xs-12\">'\n        + '<button data-phone-id=\"\" type=\"button\" class=\"close btn-remove-phone\"><i class=\"fa fa-remove\"></i></button>'\n        + '</div>'\n        + '</div>';\n        $(btn_remove).prependTo(el);\n        el.find(\"[name='phones_id[]']\").val(\"\");\n        el.find(\"input[type='text']\").val(\"\");\n        el.find(\"input[type='text']\").removeClass(\"error\");\n        el.find(\"input[type='text']\").removeAttr(\"aria-required\");\n        el.find(\"input[type='text']\").removeAttr(\"aria-invalid\");\n        el.find(\".element-phone\").removeAttr(\"id\");\n        el.find(\".element-phone\").find(\"#phones-error\").remove();\n        var count = $(\".element-phone\").find('.phone').length;\n        el.find(\"input[type='text']\").attr(\"id\", \"phones_\" + (count + 1));\n        el.find('label.error').attr({\n            \"id\": \"phones_\" + (count + 1) + \"-error\",\n            \"for\": \"phones_\" + (count + 1)\n        })\n\n        $(el).appendTo(\".optional-plus-phones\");\n\n        // Action remove\n        $(\".btn-remove-phone\").off('click').on('click', function(e) {\n            var element = this;\n            var phone_id = $(this).data('phone-id');\n            var user_id = $(this).parents('form').find(\"#user_id\").val();\n            if(phone_id != '') {\n                swal({\n                    title: \"Estas seguro?\",\n                    text: \"¿ Realmente deseas eliminar el teléfono del usuario ?.\",\n                    type: \"warning\",\n                    showCancelButton: true,\n                    confirmButtonColor: \"#DD6B55\",\n                    confirmButtonText: \"Si, eliminar!\",\n                    closeOnConfirm: false\n                },\n                function(){\n                    Pace.track(function() {\n                        // Ajax request\n                        $.ajax({\n                            url: '/coordinador/user/phone/delete/' + phone_id,\n                            type: 'GET',\n                            dataType: 'JSON',\n                            beforeSend: function() {\n                                swal.disableButtons();\n                            },\n                            success: function(json) {\n                                if(json.response == \"ok\")\n                                {\n                                    swal(\"Eliminado!\", \"El teléfono se ha eliminado con éxito.\", \"success\");\n                                    $(element).parents(\"div.element-phone\").remove();\n                                    table = $(\"#table-list-users\").DataTable();\n                                    table.ajax.reload();\n                                }\n                            },\n                            error: function(jqXHR) {\n                                displayErrors(jqXHR);\n                            }\n                        })\n                    })\n                    // /.PACE\n                })\n                // /.FUNCTION\n            }else{\n                $(this).parents(\"div.element-phone\").remove();\n            }\n        })\n        // Add validate\n        var phones = $(\".phone\");\n        $.each(phones, function(x, input) {\n            $(input).rules('add', {\n                required: true\n            })\n            $(input).numeric_input({\n                decimal: '.',\n                numberOfDecimals: null\n            });\n        })\n    })\n\n    // Toggle password\n    $(\"#toggle-password\").on('click', function(e) {\n        var input_passwd = $(\"#password\");\n        var show_pass_input = $(\"#show-password\");\n        var value = input_passwd.val();\n        if(value) {\n            if(input_passwd.is(\":visible\")) {\n                input_passwd.hide();\n                show_pass_input.val(value);\n                show_pass_input.show();\n            }else{\n                input_passwd.show();\n                show_pass_input.val(\"\");\n                show_pass_input.hide();\n            }\n        }\n    })\n\n    // Method Generate password random\n    function generatePassword(longitud)\n    {\n        var str = \"abcdefghijkmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ123467890\";\n        var password = \"\";\n        for (i=0; i<longitud; i++) {\n            password += str.charAt(Math.floor(Math.random()*str.length));\n        }\n        return password;\n    }\n\n    $(\"#generate-password\").on(\"click\", function() {\n        var input_passwd = $(\"#password\");\n        var text_password = $(\"#show-password\");\n        // Generate passwd\n        var generate_passwd = generatePassword(8);\n        // Set passwd to input\n        input_passwd.hide();\n        input_passwd.val(generate_passwd);\n        text_password.val(generate_passwd);\n        text_password.show();\n    })\n\n    // Activate tooltips\n    $(\"[data-toggle=tooltip]\").tooltip();\n    // Activate select2\n    $(\".simple-select\").select2({\n        placeholder: \"Seleccione...\",\n    });\n    $(\".address-select\").select2({\n        placeholder: \"Seleccione...\",\n    });\n    $(\".speciality-select\").select2({\n        placeholder: \"Seleccione una especialidad\",\n    });\n    \n\n    $(\"#state\").on('change', function (e, dataAddress) {\n        var value = e.target.value;\n        var state = e.target.options[e.target.options.selectedIndex].dataset.id;\n        $(\"#province\").children().remove();\n        $(\"#province\").select2(\"destroy\");\n        // SELECT PROVINCE FROM LOCALITY\n        Pace.track(function () {\n            var getProvinces = $.ajax({\n                url: '/admin/api/get/provinces/' + state,\n                type: 'GET',\n                dataType: 'json'\n            });\n            getProvinces.done(function (json) {\n                $(\"#province\").select2({\n                    data: json.data\n                });\n                $.each($(\"#province\").children(), function (x, op) {\n                    $(op).attr('data-id', json.data[x].dataId);\n                })\n                // trigger provinces\n                $(\"#province\").val(dataAddress.province).trigger('change', dataAddress.locality);\n            })\n            getProvinces.fail(function (jqXHR, textStatus) {\n                displayErrors(jqXHR);\n            });\n        })\n        // ./PACE\n    })\n\n    $(\"#province\").on('change', function (e, locality) {\n        var value = e.target.value;\n        var province = e.target.options[e.target.options.selectedIndex].dataset.id;\n        $(\"#locality\").children().remove();\n        $(\"#locality\").select2(\"destroy\");\n        // SELECT PROVINCE FROM LOCALITY\n        Pace.track(function () {\n            var getProvinces = $.ajax({\n                url: '/admin/api/get/localities/' + province,\n                type: 'GET',\n                dataType: 'json'\n            });\n            getProvinces.done(function (json) {\n                $(\"#locality\").select2({\n                    data: json.data\n                });\n                $(\"#locality\").val(locality).trigger('change');\n            })\n            getProvinces.fail(function (jqXHR, textStatus) {\n                displayErrors(jqXHR);\n            });\n        })\n        // ./PACE\n    })\n\n    // ICHECK RADIO\n    $(\".square_radio\").iCheck({\n        checkboxClass: 'icheckbox_square-blue',\n        radioClass: 'iradio_square-blue',\n        increaseArea: '20%'\n    })\n\n    function displayErrors(jqXHR) {\n        var errors = [];\n        if (jqXHR.responseJSON) {\n            $.each(jqXHR.responseJSON, function (x, error) {\n                $.each(error, function (x, o) {\n                    errors.push(o);\n                })\n            })\n\n            if (errors.length > 0) {\n                var html = '<ul>';\n                $.each(errors, function (x, e) {\n                    html += '<li style=\"list-style:square;text-align:left;margin-bottom:8px;color:red;\">'\n                        + e;\n                    + '</li>';\n                })\n                html += '</ul>';\n\n                swal({\n                    title: 'Han ocurrido los siguientes errores',\n                    text: html,\n                    html: true\n                })\n            }\n        }\n    }\n\n    // Activate link\n    var url = $(\"#url-active\").data(\"url-active\");\n    global.url_active(url);\n})"]}