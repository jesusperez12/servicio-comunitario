{"version":3,"sources":["permissions.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"permissions.js","sourcesContent":["$(document).ready(function() {\n    // Load list permissions\n    var table_list_permissions = null;\n    Pace.track(function() {\n        table_list_permissions = $(\"#table-list-permissions\").DataTable({\n            ajax: '/admin/user/permission/all',\n            ordering : false,\n            pagingType: \"simple_numbers\",\n            pageLength: 8,\n            lengthChange: false,\n            searching: false,\n            info: false,\n            displayStart: 0,\n            autoWidth: false,\n            language: {\n                loadingRecords: \"Cargando...\",\n                emptyTable:     \"No hay datos disponibles en la tabla\",\n                info:           \"Mostrando _START_ a _END_ de _TOTAL_ registros\",\n                infoEmpty:      \"Mostrando 0 a 0 de 0 registros\",\n                zeroRecords:    \"No hay permisos registrados...\",\n                search: \"\",\n                searchPlaceholder: \"Buscar en lista de permisos...\",\n                infoFiltered: \" - filtrado para _MAX_ registros\",\n                paginate: {\n                    first:      \"Primero\",\n                    last:       \"Último\",\n                    next:       \"Siguiente\",\n                    previous:   \"Anterior\"\n                }\n            },\n            columns: [\n                {\n                    data: 'permission',\n                    render: function(data, type, row) {\n                        var data = row.permission_slug + \" <sapn class='nP'>(\" + row.permission + \")</span>\";    \n                        return '<div class=\"xS noellipsis\">'\n                        + data\n                        + '</div>';\n                    }\n                },\n                {\n                    className: 'xY',\n                    data: 'description',\n                    render: function(data, type, row) {\n                        return '<div class=\"xS noellipsis\">'\n                        + row.description\n                        + '</div>';\n                    }\n                },\n                {\n                    className:\"text-center\",\n                    data: null,\n                    render: function(data, type, row) {\n                        return '<a class=\"btn btn-xs btn-danger btn-delete-permission\" data-permission-id=\"'+ row.id +'\" href=\"#!\"'\n                        + 'data-toggle=\"tooltip\" data-container=\"body\" data-title=\"Eliminar\"><span><i class=\"fa fa-remove\"></i></span></a>'\n                        + '&nbsp;&nbsp;'\n                        + '<a class=\"btn btn-xs btn-warning btn-edit-permission\" data-permission-id=\"'+ row.id +'\" href=\"#!\"'\n                        + 'data-toggle=\"tooltip\" data-container=\"body\" data-title=\"Editar\"><span><i class=\"fa fa-pencil\"></i></span></a>';\n                    }\n                }\n            ]\n        })\n\n        // REQUEST DELETE PERMISSION\n        $(\"#table-list-permissions\").find(\"tbody\").on('click', '.btn-delete-permission',function(e) {\n            e.preventDefault();\n            // Rows\n            var row = $(this).parents('tr');\n            var pid = $(this).data(\"permission-id\");\n            swal({\n                title: \"Estas seguro?\",\n                text: \"Esta acción no se podrá deshacer.\",\n                type: \"warning\",\n                showCancelButton: true,\n                confirmButtonColor: \"#DD6B55\",\n                confirmButtonText: \"Si, eliminar!\",\n                closeOnConfirm: false\n            },\n            function(){\n                Pace.track(function() {\n                    // Ajax request\n                    $.ajax({\n                        url: '/admin/user/permission/delete/' + pid,\n                        type: 'GET',\n                        dataType: 'JSON',\n                        beforeSend: function() {\n                            swal.disableButtons();\n                        },\n                        success: function(json) {\n                            console.log(json);\n                            if(json.response == \"ok\")\n                            {\n                                swal(\"Eliminado!\", \"El permiso se ha eliminado con éxito.\", \"success\");\n                                row.fadeOut();\n                            }\n                        },\n                        error: function(jqXHR) {\n                            var errors = [];\n                            if (jqXHR.responseJSON) {\n                                $.each(jqXHR.responseJSON, function (x, error) {\n                                    $.each(error, function (x, o) {\n                                        errors.push(o);\n                                    })\n                                })\n\n                                if (errors.length > 0) {\n                                    var html, title;\n                                    if (errors.length > 1) {\n                                        title = 'Han ocurrido los siguientes errores';\n                                        html = '<ul>';\n                                        $.each(errors, function (x, e) {\n                                            html += '<li style=\"list-style:square;text-align:left;margin-bottom:8px;color:red;\">'\n                                                + e;\n                                            + '</li>';\n                                        })\n                                        html += '</ul>';\n                                    } else {\n                                        title = '¡Acción denegada!';\n                                        html = errors[0];\n                                    }\n\n                                    swal({\n                                        title: title,\n                                        text: html,\n                                        html: true\n                                    })\n                                }\n                            }\n                        }\n                    })\n                })\n                // /.PACE\n            })\n            // /.FUNCTION\n        })\n        // /.SWAL\n\n        // REQUEST EDIT PERMISSION\n        $(\"#table-list-permissions\").find(\"tbody\").on('click', '.btn-edit-permission',function(e) {\n            e.preventDefault();\n            var btn = this;\n            var pid = $(this).data(\"permission-id\"); \n            Pace.track(function() {\n                // Ajax request\n                $.ajax({\n                    url: '/admin/user/permission/edit/' + pid,\n                    type: 'GET',\n                    dataType: 'html',\n                    beforeSend: function() {\n                        $(btn).attr(\"disabled\", true);\n                    },\n                    success: function(json) {\n                        if(json)\n                        {\n                            $(\"#load_form_edit\").html(json).show();\n                            $(\"#load_form_add\").hide();\n\n                            // INIT FORM EDIT VALIDATE\n                            initFormEditValidate();\n\n                            // BTN CANCEL UPDATE\n                            $(\"#b-can-up-pe\").on('click', function() {\n                                $(\"#load_form_edit\").html(\"\").hide();\n                                $(\"#load_form_add\").show();\n                            })\n                        }\n                        $(btn).attr(\"disabled\", false);\n                    },\n                    error: function(error) {\n                        $.each(error, function(a, b) {\n                            console.log(a+' => '+b)\n                        })\n                    }\n                })\n                // /.AJAX\n            })\n            // /.PACE\n        })\n\n        global.noEllipsis($(\"#table-list-permissions\"));\n    })\n\n    // Form add permission\n    $(\"#form-add-permission\").validate({\n        submitHandler: function(form) {\n            Pace.track(function() {\n                var data = $(form).serialize();\n                // Ajax request\n                $.ajax({\n                    url: '/admin/user/permission',\n                    data: data,\n                    type: 'POST',\n                    dataType: 'json',\n                    success: function(json) {\n                        if(json.response == \"ok\")\n                        {\n                            $(form).trigger(\"reset\");\n                            table_list_permissions.ajax.reload();\n                        }\n                    },\n                    error: function(error) {\n                        $.each(error, function(a, b) {\n                            console.log(a+' => '+b)\n                        })\n                    }\n                })\n                // /.Ajax\n            })\n            // /.Pace\n        },\n        rules: {\n            permission: {\n                required: true,\n                excludeletters: true\n            },\n            permission_slug: {\n                required: true,\n                excludeletters: true\n            },\n            description: {\n                required: true\n            }\n        }\n    })\n\n    // Form edit permission\n    function initFormEditValidate()\n    {\n        $(\"#form-edit-permission\").validate({\n            submitHandler: function(form) {\n                var pid = form.permission_id.value;\n                Pace.track(function() {\n                    var data = $(form).serialize();\n                    // Ajax request\n                    $.ajax({\n                        url: '/admin/user/permission/' + pid,\n                        data: data,\n                        type: 'POST',\n                        dataType: 'json',\n                        success: function(json) {\n                            if(json.response == \"ok\")\n                            {\n                                // Reset form edit\n                                $(form).trigger(\"reset\");\n                                $(\"#load_form_edit\").html(\"\").hide();\n                                $(\"#load_form_add\").show();\n                                // Refresh list permissions\n                                table_list_permissions.ajax.reload();\n                            }\n                        },\n                        error: function(error) {\n                            $.each(error, function(a, b) {\n                                console.log(a+' => '+b)\n                            })\n                        }\n                    })\n                    // /.Ajax\n                })\n                // /.Pace\n            },\n            rules: {\n                permission: {\n                    required: true,\n                    excludeletters: true\n                },\n                permission_slug: {\n                    required: true,\n                    excludeletters: true\n                },\n                description: {\n                    required: true\n                }\n            }\n        })\n    }\n\n    // Create slug permission in add\n    $(\"#form-add-permission\").find(\"#permission\").on('keyup', function(e) {\n        var start = this.selectionStart, end = this.selectionEnd;\n        this.value = e.currentTarget.value.replace(/\\s+/g, ' ');\n        var value = e.currentTarget.value.replace(/\\s+|\\_+/g, '_');\n        this.setSelectionRange(start, end);\n        setTimeout(function() {\n            $(\"#form-add-permission\").find(\"#permission_slug\").val(value.toUpperCase());\n        }, 100)\n    })\n    // Create slug permission in edit\n    $(\"#form-edit-permission\").find(\"#permission\").on('keyup', function(e) {\n        var start = this.selectionStart, end = this.selectionEnd;\n        this.value = e.currentTarget.value.replace(/\\s+/g, ' ');\n        var value = e.currentTarget.value.replace(/\\s+|\\_+/g, '_');\n        this.setSelectionRange(start, end);\n        setTimeout(function() {\n            $(\"#form-edit-permission\").find(\"#permission_slug\").val(value.toUpperCase());\n        }, 100)\n    })\n\n    // Ellipsis text table rol permissions\n    var trs = $(\"#table-list-permissions\").find(\"tbody\").children();\n    $.each(trs, function(key, tr) {\n        var txt_complete = $.trim($(tr.cells[1]).text());\n        if(txt_complete.length > 50) {\n            var txt_short = txt_complete.slice(0, 49)+\"...<a href='javascript:;' data-toggle='popover' data-placement='left' data-trigger='focus' title='DESCRIPCIÓN' data-content='\"+txt_complete+\"'><span><i class='fa fa-info-circle'></i></span></a>\";\n            // Set value to cell\n            $(tr.cells[1]).html(txt_short);\n        }\n    })\n\n    // Activate popover\n    $(\"[data-toggle=popover]\").popover({\n        html: true\n    });\n    // Activate link\n    var url = $(\"#url-active\").data(\"url-active\");\n    global.url_active(url);\n})"]}