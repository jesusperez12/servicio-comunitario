{"version":3,"sources":["roles.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"roles.js","sourcesContent":["$(document).ready(function() {\n    // Load list permissions\n    var table_list_roles_permissions = null;\n    Pace.track(function() {\n        table_list_roles_permissions = $(\"#table-list-roles-permissions\").DataTable({\n            ajax: '/admin/user/role/all',\n            ordering : false,\n            pagingType: \"simple_numbers\",\n            pageLength: 8,\n            lengthChange: false,\n            searching: false,\n            info: false,\n            displayStart: 0,\n            autoWidth: false,\n            language: {\n                loadingRecords: \"Cargando...\",\n                emptyTable:     \"No hay datos disponibles en la tabla\",\n                info:           \"Mostrando _START_ a _END_ de _TOTAL_ registros\",\n                infoEmpty:      \"Mostrando 0 a 0 de 0 registros\",\n                zeroRecords:    \"No hay permisos registrados...\",\n                search: \"\",\n                searchPlaceholder: \"Buscar en lista de roles...\",\n                infoFiltered: \" - filtrado para _MAX_ registros\",\n                paginate: {\n                    first:      \"Primero\",\n                    last:       \"Último\",\n                    next:       \"Siguiente\",\n                    previous:   \"Anterior\"\n                }\n            },\n            columns: [\n                {\n                    data: 'role',\n                    render: function(data, type, row) {\n                        var data = row.role;    \n                        return '<div class=\"xS noellipsis\">'\n                        + data\n                        + '</div>';\n                    }\n                },\n                {\n                    className: 'xY',\n                    data: 'description',\n                    render: function(data, type, row) {\n                        return '<div class=\"xS noellipsis\">'\n                        + row.description\n                        + '</div>';\n                    }\n                },\n                {\n                    className:\"text-center\",\n                    data: null,\n                    render: function(data, type, row) {\n                        return '<a class=\"btn btn-xs btn-success btn-add-permissions\" data-role-id=\"'+ row.id +'\" data-role=\"'+ row.role +'\" href=\"#!\"'\n                        + 'data-toggle=\"tooltip\" data-container=\"body\" data-title=\"Asignar o editar permisos\"><span><i class=\"fa fa-key\"></i></span></a>'\n                        + '&nbsp;&nbsp;'\n                        + '<a class=\"btn btn-xs btn-danger btn-delete-role\" data-role-id=\"'+ row.id +'\" href=\"#!\"'\n                        + 'data-toggle=\"tooltip\" data-container=\"body\" data-title=\"Eliminar\"><span><i class=\"fa fa-remove\"></i></span></a>'\n                        + '&nbsp;&nbsp;'\n                        + '<a class=\"btn btn-xs btn-warning btn-edit-role\" data-role-id=\"'+ row.id +'\" href=\"#!\"'\n                        + 'data-toggle=\"tooltip\" data-container=\"body\" data-title=\"Editar\"><span><i class=\"fa fa-pencil\"></i></span></a>';\n                    }\n                }\n            ]\n        })\n\n        // REQUEST ASSIGN PERMISSION\n        $(\"#table-list-roles-permissions\").find(\"tbody\").on('click', '.btn-add-permissions',function(e) {\n            e.preventDefault();\n            var rid = $(this).data(\"role-id\");\n            var rname = $(this).data(\"role\");\n            Pace.track(function() {\n                // Ajax request\n                $.ajax({\n                    url: '/admin/user/role/' + rid + '/permissions',\n                    type: 'GET',\n                    dataType: 'json',\n                    success: function(json) {\n                        if(json.response == 'ok')\n                        {\n                            $(\"#f-add-pr\").find(\"#role_id\").val(rid);\n                            $(\"#f-add-pr\").find(\"#role-assign\").val(rname);\n\n                            var selections = [];\n                            $.each(json.permissions, function(key, permission) {\n                                selections.push(permission.id);\n                            })\n                            if(selections.length > 0)\n                            {\n                                $(\"#list-permissions\").val(selections).trigger('change');\n                            }\n                            // Show modal\n                            $(\"#mf-add-pr\").modal({\n                                show: true,\n                                backdrop: 'static',\n                                keyboard: false\n                            });\n                        }\n                    },\n                    error: function(jqXHR) {\n                        var errors = [];\n                        if (jqXHR.responseJSON) {\n                            $.each(jqXHR.responseJSON, function (x, error) {\n                                $.each(error, function (x, o) {\n                                    errors.push(o);\n                                })\n                            })\n\n                            if (errors.length > 0) {\n                                var html, title;\n                                if (errors.length > 1) {\n                                    title = 'Han ocurrido los siguientes errores';\n                                    html = '<ul>';\n                                    $.each(errors, function (x, e) {\n                                        html += '<li style=\"list-style:square;text-align:left;margin-bottom:8px;color:red;\">'\n                                            + e;\n                                        + '</li>';\n                                    })\n                                    html += '</ul>';\n                                } else {\n                                    title = '¡Acción denegada!';\n                                    html = errors[0];\n                                }\n\n                                swal({\n                                    title: title,\n                                    text: html,\n                                    html: true\n                                })\n                            }\n                        }\n                    }\n                })\n            })\n        })\n        \n\n        // REQUEST DELETE PERMISSION\n        $(\"#table-list-roles-permissions\").find(\"tbody\").on('click', '.btn-delete-role',function(e) {\n            e.preventDefault();\n            // Rows\n            var row = $(this).parents('tr');\n            var row_next = row.next();\n            var pid = $(this).data(\"role-id\");\n            swal({\n                title: \"Estas seguro?\",\n                text: \"Esta acción no se podrá deshacer.\",\n                type: \"warning\",\n                showCancelButton: true,\n                confirmButtonColor: \"#DD6B55\",\n                confirmButtonText: \"Si, eliminar!\",\n                closeOnConfirm: false\n            },\n            function(){\n                Pace.track(function() {\n                    // Ajax request\n                    $.ajax({\n                        url: '/admin/user/role/delete/' + pid,\n                        type: 'GET',\n                        dataType: 'JSON',\n                        beforeSend: function() {\n                            swal.disableButtons();\n                        },\n                        success: function(json) {\n                            if(json.response == \"ok\")\n                            {\n                                swal(\"Eliminado!\", \"El rol se ha eliminado con éxito.\", \"success\");\n                                row.fadeOut();\n                                // row_next.fadeOut();\n                            }\n                        },\n                        error: function(jqXHR) {\n                            var errors = [];\n                            if (jqXHR.responseJSON) {\n                                $.each(jqXHR.responseJSON, function (x, error) {\n                                    $.each(error, function (x, o) {\n                                        errors.push(o);\n                                    })\n                                })\n\n                                if (errors.length > 0) {\n                                    var html, title;\n                                    if (errors.length > 1) {\n                                        title = 'Han ocurrido los siguientes errores';\n                                        html = '<ul>';\n                                        $.each(errors, function (x, e) {\n                                            html += '<li style=\"list-style:square;text-align:left;margin-bottom:8px;color:red;\">'\n                                                + e;\n                                            + '</li>';\n                                        })\n                                        html += '</ul>';\n                                    } else {\n                                        title = '¡Acción denegada!';\n                                        html = errors[0];\n                                    }\n\n                                    swal({\n                                        title: title,\n                                        text: html,\n                                        html: true\n                                    })\n                                }\n                            }\n                        }\n                    })\n                })\n                // /.PACE\n            })\n            // /.FUNCTION\n        })\n        // /.SWAL\n\n        // REQUEST EDIT PERMISSION\n        $(\"#table-list-roles-permissions\").find(\"tbody\").on('click', '.btn-edit-role',function(e) {\n            e.preventDefault();\n            var btn = this;\n            var rid = $(this).data(\"role-id\"); \n            Pace.track(function() {\n                // Ajax request\n                $.ajax({\n                    url: '/admin/user/role/edit/' + rid,\n                    type: 'GET',\n                    dataType: 'html',\n                    beforeSend: function() {\n                        $(btn).attr(\"disabled\", true);\n                    },\n                    success: function(json) {\n                        if(json)\n                        {\n                            $(\"#load_form_edit\").html(json).show();\n                            $(\"#load_form_add\").hide();\n\n                            // INIT FORM EDIT VALIDATE\n                            initFormEditValidate();\n\n                            // BTN CANCEL UPDATE\n                            $(\"#b-can-up-ro\").on('click', function() {\n                                $(\"#load_form_edit\").html(\"\").hide();\n                                $(\"#load_form_add\").show();\n                            })\n                        }\n                        $(btn).attr(\"disabled\", false);\n                    },\n                    error: function(jqXHR) {\n                        var errors = [];\n                        if (jqXHR.responseJSON) {\n                            $.each(jqXHR.responseJSON, function (x, error) {\n                                $.each(error, function (x, o) {\n                                    errors.push(o);\n                                })\n                            })\n\n                            if (errors.length > 0) {\n                                var html, title;\n                                if (errors.length > 1) {\n                                    title = 'Han ocurrido los siguientes errores';\n                                    html = '<ul>';\n                                    $.each(errors, function (x, e) {\n                                        html += '<li style=\"list-style:square;text-align:left;margin-bottom:8px;color:red;\">'\n                                            + e;\n                                        + '</li>';\n                                    })\n                                    html += '</ul>';\n                                } else {\n                                    title = '¡Acción denegada!';\n                                    html = errors[0];\n                                }\n\n                                swal({\n                                    title: title,\n                                    text: html,\n                                    html: true\n                                })\n                            }\n                        }\n                    }\n                })\n                // /.AJAX\n            })\n            // /.PACE\n        })\n\n        global.noEllipsis($(\"#table-list-roles-permissions\"));\n    })\n\n    // FORM ASSIGN PERMISSION\n    $(\"#f-add-pr\").validate({\n        submitHandler: function(form) {\n            var data = $(form).serialize();\n            $.ajax({\n                url: '/admin/user/role/assign/permission',\n                data: data,\n                type: 'POST',\n                dataType: 'json',\n                success: function(json) {\n                    if(json.response == 'ok') {\n                        $(\"#mf-add-pr\").modal('hide');\n                    }else{\n                        console.log(json.response);\n                    }\n                },\n                error: function(jqXHR) {\n                    var errors = [];\n                    if (jqXHR.responseJSON) {\n                        $.each(jqXHR.responseJSON, function (x, error) {\n                            $.each(error, function (x, o) {\n                                errors.push(o);\n                            })\n                        })\n\n                        if (errors.length > 0) {\n                            var html, title;\n                            if (errors.length > 1) {\n                                title = 'Han ocurrido los siguientes errores';\n                                html = '<ul>';\n                                $.each(errors, function (x, e) {\n                                    html += '<li style=\"list-style:square;text-align:left;margin-bottom:8px;color:red;\">'\n                                        + e;\n                                    + '</li>';\n                                })\n                                html += '</ul>';\n                            } else {\n                                title = '¡Acción denegada!';\n                                html = errors[0];\n                            }\n\n                            swal({\n                                title: title,\n                                text: html,\n                                html: true\n                            })\n                        }\n                    }\n                }\n            })\n        }\n    })\n\n    // Validate form add role\n    $(\"#form-add-role\").validate({\n        submitHandler: function(form) {\n            Pace.track(function() {\n                var data = $(form).serialize();\n                // Ajax request\n                $.ajax({\n                    url: '/admin/user/role',\n                    data: data,\n                    type: 'POST',\n                    dataType: 'json',\n                    success: function(json) {\n                        if(json.response == \"ok\")\n                        {\n                            $(form).trigger(\"reset\");\n                            table_list_roles_permissions.ajax.reload();\n                        }\n                    },\n                    error: function(jqXHR) {\n                        var errors = [];\n                        if (jqXHR.responseJSON) {\n                            $.each(jqXHR.responseJSON, function (x, error) {\n                                $.each(error, function (x, o) {\n                                    errors.push(o);\n                                })\n                            })\n\n                            if (errors.length > 0) {\n                                var html, title;\n                                if (errors.length > 1) {\n                                    title = 'Han ocurrido los siguientes errores';\n                                    html = '<ul>';\n                                    $.each(errors, function (x, e) {\n                                        html += '<li style=\"list-style:square;text-align:left;margin-bottom:8px;color:red;\">'\n                                            + e;\n                                        + '</li>';\n                                    })\n                                    html += '</ul>';\n                                } else {\n                                    title = '¡Acción denegada!';\n                                    html = errors[0];\n                                }\n\n                                swal({\n                                    title: title,\n                                    text: html,\n                                    html: true\n                                })\n                            }\n                        }\n                    }\n                })\n                // /.Ajax\n            })\n            // /.Pace\n        },\n        rules: {\n            role: {\n                required: true,\n                excludeletters: true\n            },\n            description: {\n                required: true\n            }\n        }\n    })\n\n    // Validate form edit role\n    function initFormEditValidate()\n    {\n        $(\"#form-edit-role\").validate({\n            submitHandler: function(form) {\n                var pid = form.role_id.value;\n                Pace.track(function() {\n                    var data = $(form).serialize();\n                    // Ajax request\n                    $.ajax({\n                        url: '/admin/user/role/' + pid,\n                        data: data,\n                        type: 'POST',\n                        dataType: 'json',\n                        success: function(json) {\n                            if(json.response == \"ok\")\n                            {\n                                // Reset form edit\n                                $(form).trigger(\"reset\");\n                                $(\"#load_form_edit\").html(\"\").hide();\n                                $(\"#load_form_add\").show();\n                                // Refresh list permissions\n                                table_list_roles_permissions.ajax.reload();\n                            }\n                        },\n                        error: function(jqXHR) {\n                            var errors = [];\n                            if (jqXHR.responseJSON) {\n                                $.each(jqXHR.responseJSON, function (x, error) {\n                                    $.each(error, function (x, o) {\n                                        errors.push(o);\n                                    })\n                                })\n\n                                if (errors.length > 0) {\n                                    var html, title;\n                                    if (errors.length > 1) {\n                                        title = 'Han ocurrido los siguientes errores';\n                                        html = '<ul>';\n                                        $.each(errors, function (x, e) {\n                                            html += '<li style=\"list-style:square;text-align:left;margin-bottom:8px;color:red;\">'\n                                                + e;\n                                            + '</li>';\n                                        })\n                                        html += '</ul>';\n                                    } else {\n                                        title = '¡Acción denegada!';\n                                        html = errors[0];\n                                    }\n\n                                    swal({\n                                        title: title,\n                                        text: html,\n                                        html: true\n                                    })\n                                }\n                            }\n                        }\n                    })\n                    // /.Ajax\n                })\n                // /.Pace\n            },\n            rules: {\n                role: {\n                    required: true,\n                    excludeletters: true\n                },\n                description: {\n                    required: true\n                }\n            }\n        })\n    }\n\n\n    // Ellipsis text table rol permissions\n    var trs = $(\"#table-list-roles-permissions\").find(\"tbody\").children();\n    $.each(trs, function(key, tr) {\n        var txt_complete = $.trim($(tr.cells[1]).text());\n        if(txt_complete.length > 50) {\n            var txt_short = txt_complete.slice(0, 49)+\"...<a href='javascript:;' data-toggle='popover' data-placement='left' data-trigger='focus' title='DESCRIPCIÓN' data-content='\"+txt_complete+\"'><span><i class='fa fa-info-circle'></i></span></a>\";\n            // Set value to cell\n            $(tr.cells[1]).html(txt_short);\n        }\n    })\n    // Hide modal\n    $(\"#mf-add-pr\").on('hide.bs.modal', function() {\n        $(\"#list-permissions\").val('').trigger('change');\n    })\n    // Logic to select list permissions\n    $(\"#list-permissions\").select2({\n        placeholder: \"Seleccione los permisos\"\n    });\n\n    // Activate tooltip\n    $(\"[data-toggle=tooltip]\").tooltip();\n    // Activate popover\n    $(\"[data-toggle=popover]\").popover();\n    // Activate link\n    var url = $(\"#url-active\").data(\"url-active\");\n    global.url_active(url);\n})"]}