{"version":3,"sources":["reports_list.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"reports_list.js","sourcesContent":["$(document).ready(function() {\n    \n    var table_list_reports = null;\n    var table_p_red = null;\n    Pace.track(function() {\n        table_list_reports = $(\"#table-my-list-reports\").DataTable({\n            ajax: '/admin/profesor/api/service/reports',\n            dom: `<'row'<'col-sm-6 reports-list-items'f><'col-sm-6'<'#btn_actions_ls_activities.pull-right'>>>\n                  <'row'<'col-sm-12'tr>>\n                  <'row'<'col-sm-5'i><'col-sm-7'p>>`,\n            initComplete: function(settings) {\n                $(\"#btn_actions_ls_activities\").html('<a href=\"../service/reporte/nuevo\" class=\"btn btn-warning btn-sm\"><i class=\"fa fa-plus\"></i> &nbsp;Reportar actividad</a>');\n            },\n            drawCallback: function(settings) {\n                var api = this.api();\n                $.each(api.rows().nodes(), function(x, tr){\n                    $(tr).find('[data-toggle=tooltip]').tooltip();\n                    // FUNCTION DETALLES DE LA ACTIVIDAD\n                    $(tr).find('.btn-view-report').off('click').on('click', function(e) {\n                        e.preventDefault();\n                        var id = $(this).data('id');\n                        var tr_n = $(tr).closest('tr');\n                        var row = api.row( tr_n );\n                        if($(this).hasClass('active')) {\n                            row.child.hide(\"slow\");\n                            $(this).removeClass('active');\n                            return;\n                        }\n                        $(this).parent().find('a').removeClass('active');\n                        $(this).addClass('active');\n                        if(row.child.isShown()){\n                            row.child.hide(\"slow\");\n                        }\n                        row.child( show_view_report(row.data()) ).show();\n                        tr_n.next().find(\".view_html\").slideDown(200);\n                        tr_n.next().find('td').first().css({ 'border-top': '2px solid #4879BE', 'border-bottom': '2px solid #4879BE', 'background-color':'lightgoldenrodyellow' });\n                    });\n                    // FUNCTION DELETE ACTIVIDAD\n                    $(tr).find('.btn-delete-report').off('click').on('click', function(e) {\n                        e.preventDefault();\n                        var id = $(this).data('id');\n\n                        swal({\n                            title: \"Estas seguro?\",\n                            text: \"¿ Realmente deseas eliminar esta actividad ?.<br><br><p class='sugerencia_error'>Recuerda, si la actividad tiene 24h o más de creada, no puede ser eliminada.<p><br><br>\",\n                            type: \"warning\",\n                            html: true,\n                            showCancelButton: true,\n                            confirmButtonColor: \"#DD6B55\",\n                            confirmButtonText: \"Si, eliminar!\",\n                            closeOnConfirm: false\n                        },\n                        function () {\n                            Pace.track(function () {\n                                // Ajax request\n                                $.ajax({\n                                    url: '/admin/profesor/service/reporte/delete/' + id,\n                                    type: 'GET',\n                                    dataType: 'JSON',\n                                    beforeSend: function () {\n                                        swal.disableButtons();\n                                    },\n                                    success: function (json) {\n                                        if (json.response == \"ok\") {\n                                            swal(\"Eliminado!\", \"La actividad se ha eliminado con éxito.\", \"success\");\n                                            api.ajax.reload();\n                                        }\n                                    },\n                                    error: function (jqXHR) {\n                                        var errors = [];\n                                        if (jqXHR.responseJSON) {\n                                            $.each(jqXHR.responseJSON, function (x, error) {\n                                                $.each(error, function (x, o) {\n                                                    errors.push(o);\n                                                })\n                                            })\n\n                                            if (errors.length > 0) {\n                                                var html, title;\n                                                if (errors.length > 1) {\n                                                    title = 'Han ocurrido los siguientes errores';\n                                                    html = '<ul>';\n                                                    $.each(errors, function (x, e) {\n                                                        html += '<li style=\"list-style:square;text-align:left;margin-bottom:8px;color:red;\">'\n                                                            + e;\n                                                        + '</li>';\n                                                    })\n                                                    html += '</ul>';\n                                                } else {\n                                                    title = '¡Acción denegada!';\n                                                    html = errors[0];\n                                                }\n\n                                                swal({\n                                                    title: title,\n                                                    text: html,\n                                                    html: true\n                                                })\n                                            }\n                                        }\n                                    }\n                                })\n                            })\n                            // /.PACE\n                        })\n                        // /.FUNCTION\n                    });\n                })\n            },\n            ordering : false,\n            pagingType: \"simple_numbers\",\n            pageLength: 10,\n            lengthChange: false,\n            searching: true,\n            info: true,\n            displayStart: 0,\n            autoWidth: false,\n            language: {\n                loadingRecords: \"Cargando...\",\n                emptyTable:     \"No hay registro de actividades\",\n                info:           \"Mostrando _START_ a _END_ de _TOTAL_ registros\",\n                infoEmpty:      \"Mostrando 0 a 0 de 0 registros\",\n                zeroRecords:    \"No se encontraron actividades...\",\n                search: \"\",\n                searchPlaceholder: \"Buscar en lista de actividades...\",\n                infoFiltered: \" - filtrado para _MAX_ registros\",\n                paginate: {\n                    first:      \"Primero\",\n                    last:       \"Último\",\n                    next:       \"Siguiente\",\n                    previous:   \"Anterior\"\n                }\n            },\n            columns: [\n                {\n                    data: 'fecha'\n                },\n                {\n                    className: 'xS',\n                    data: 'actividad'\n                },\n                {\n                    data: 'hrs',\n                    render: function(data, type, row) {\n                        if(parseFloat(row.hrs) > 1.0) {\n                            return row.hrs + ' Hrs.'\n                        }else{\n                            return row.hrs + ' Hr.'\n                        }\n                    }\n                },\n                {\n                    data: 'periodo.corte'\n                },\n                {\n                    className: 'p-actions text-center',\n                    data: null,\n                    render: function(data, type, row) {\n                        var actions = `<a href='#!' class='btn btn-default btn-xs btn-action btn-view-report' data-id='${row.id}' data-toggle='tooltip' data-placement='top' data-title='Vista previa'><i class='fa fa-eye'></i></a>\n                                       <a href='../service/reporte/edit/${row.id}/proyecto/${row.proyecto.id}/periodo/${row.periodo.id}' class='btn btn-warning btn-xs btn-action btn-edit-report' data-id='${row.id}' data-toggle='tooltip' data-placement='top' data-title='Editar actividad'><i class='fa fa-pencil'></i></a>\n                                       <a href='#!' class='btn btn-danger btn-xs btn-action btn-delete-report' data-id='${row.id}' data-toggle='tooltip' data-placement='top' data-title='Remover actividad'><i class='fa fa-trash'></i></a>`;\n                        return actions;\n                    }\n                },\n            ]\n        })\n    })\n\n    function show_view_report(data) {\n        if(Object.keys(data).length > 0) {\n            var box = `<div class=\"view_html\" style=\"display: none;\">\n                    <dl style=\"margin-bottom:5px;\">\n                        <dt>Proyecto comunitario:</dt>\n                        <dd>${data.proyecto.nombre_proyecto}</dd>\n                        <dt>Nombre de la actividad:</dt>\n                        <dd>${data.actividad}</dd>\n                        <dt>Dirección:</dt>\n                        <dd>${data.direccion}</dd>\n                        <dt>Impacto o alcance:</dt>\n                        <dd>${data.impacto_gen}</dd>\n                    </dl>\n                    </div>`;\n            return box;\n        }else{\n            return;\n        }\n    }\n\n    // Activate link\n    var url = $(\"#url-active\").data(\"url-active\");\n    global.url_active(url);\n})"]}