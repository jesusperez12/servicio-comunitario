{"version":3,"sources":["periodos.js","formNewPeriodo.js","formEditPeriodo.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/JA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"periodos.js","sourcesContent":["var Periodos = (function(){\n\n    var el = {\n        tableListPeriodos: '#table-list-periodos',\n        btnPeriodoAction: '#btn-action-periodo',\n        btnEditPeriodo: '.btn-edit-periodo',\n        btnDeletePeriodo: '.btn-delete-periodo',\n    };\n\n    var dom = {\n        tableListPeriodos: $(el.tableListPeriodos),\n        listTablePeriodos: null\n    };\n\n    var events = {\n        newPeriodo: function (evt) {\n            FormNewPeriodo.dom.modalAddPeriodo.trigger('showModal');\n        },\n        editPeriodo: function (evt) {\n            evt.preventDefault();\n            var id = this.dataset.periodoId;\n            Pace.track(function () {\n                $.ajax({\n                    url: `/admin/coordinador/periodo/edit/${id}`,\n                    type: 'GET',\n                    dataType: 'JSON',\n                })\n                .done(function(rs) {\n                    if (rs.response == 'ok') {\n                        FormEditPeriodo.dom.formEditPeriodo.trigger('editPeriodo', rs.data);\n                    }\n                })\n                .fail(function(jqXHR) {\n                    var errors = [];\n                    if (jqXHR.responseJSON) {\n                        $.each(jqXHR.responseJSON, function (x, error) {\n                            $.each(error, function (x, o) {\n                                errors.push(o);\n                            })\n                        })\n\n                        if (errors.length > 0) {\n                            var html, title;\n                            if (errors.length > 1) {\n                                title = 'Han ocurrido los siguientes errores';\n                                html = '<ul>';\n                                $.each(errors, function (x, e) {\n                                    html += '<li style=\"list-style:square;text-align:left;margin-bottom:8px;color:red;\">'\n                                        + e;\n                                    + '</li>';\n                                })\n                                html += '</ul>';\n                            } else {\n                                title = '¡Acción denegada!';\n                                html = errors[0];\n                            }\n\n                            swal({\n                                title: title,\n                                text: html,\n                                html: true\n                            })\n                        }\n                    }\n                })\n            })\n        },\n        deletePeriodo: function (evt) {\n            evt.preventDefault();\n            var periodo_id = this.dataset.periodoId;\n            swal({\n                title: \"Estas seguro?\",\n                text: \"Esta acción no se podrá deshacer.<br><br>\",\n                html: true,\n                type: \"warning\",\n                showCancelButton: true,\n                confirmButtonColor: \"#DD6B55\",\n                confirmButtonText: \"Si, eliminar!\",\n                closeOnConfirm: false\n            },\n            function () {\n                Pace.track(function () {\n                    // Ajax request\n                    $.ajax({\n                        url: '/admin/coordinador/periodo/delete/' + periodo_id,\n                        type: 'GET',\n                        dataType: 'JSON',\n                        beforeSend: function () {\n                            swal.disableButtons();\n                        }\n                    })\n                    .done(function (rs) {\n                        if (rs.response == \"ok\") {\n                            swal(\"Eliminado!\", \"Se ha eliminado con éxito.\", \"success\");\n                            refresh();\n                        }\n                    })\n                    .fail(function (jqXHR) {\n                        var errors = [];\n                        if (jqXHR.responseJSON) {\n                            $.each(jqXHR.responseJSON, function (x, error) {\n                                $.each(error, function (x, o) {\n                                    errors.push(o);\n                                })\n                            })\n\n                            if (errors.length > 0) {\n                                var html, title;\n                                if (errors.length > 1) {\n                                    title = 'Han ocurrido los siguientes errores';\n                                    html = '<ul>';\n                                    $.each(errors, function (x, e) {\n                                        html += '<li style=\"list-style:square;text-align:left;margin-bottom:8px;color:red;\">'\n                                            + e;\n                                        + '</li>';\n                                    })\n                                    html += '</ul>';\n                                } else {\n                                    title = '¡Acción denegada!';\n                                    html = errors[0];\n                                }\n\n                                swal({\n                                    title: title,\n                                    text: html,\n                                    html: true\n                                })\n                            }\n                        }\n                    })\n                })\n                // /.PACE\n            })\n            // /.FUNCTION\n        }\n    };\n\n    var subscribeEvents = function () {}\n    \n    var initTableListPeriodos = function () {\n        dom.listTablePeriodos = dom.tableListPeriodos.DataTable({\n            dom: `<'row'<'col-xs-6'<'#btn-action-periodo'>><'col-xs-6 t-periodo-filter'f>>\n                  <'row'<'col-xs-12'tr>>\n                  <'row'<'col-xs-5'i><'col-xs-7'p>>`,\n            ajax: '/admin/coordinador/periodos/all',\n            deferRender: true,\n            drawCallback: function (settings) {\n                var api = this.api();\n                $.each(api.rows().nodes(), function (x, tr) {\n                    $(tr).find('[data-toggle=tooltip]').tooltip();\n                    $(tr).find('[data-toggle=popover]').popover({ html: true });\n                    $(tr).attr('data-periodo-data', JSON.stringify(api.row(tr).data()));\n                    // FUNCTION EDIT PERIODO\n                    $(tr).find(el.btnEditPeriodo).off('click').on('click', events.editPeriodo);\n                    // FUNCTION DELETE PERIODO\n                    $(tr).find(el.btnDeletePeriodo).off('click').on('click', events.deletePeriodo);\n                })\n            },\n            initComplete: function (settings, json) {\n                // FILTRO\n                $(\".t-periodo-filter\").find('[type=search]').removeClass(\"input-sm\")\n                .css({\n                    \"width\": \"100%\",\n                    \"margin-left\": 0\n                })\n                .parents(\"label\").css({\n                    \"width\": \"100%\"\n                });\n                $(el.btnPeriodoAction).html(`<button class=\"btn btn-primary\" id=\"btn-new-periodo\"><i class=\"fa fa-clock-o\"></i> Nuevo periodo</button>`);\n                $(FormNewPeriodo.el.btnNewPeriodo).on('click', events.newPeriodo);\n            },\n            ordering: false,\n            paging: true,\n            pagingType: \"simple_numbers\",\n            pageLength: 10,\n            lengthChange: false,\n            searching: true,\n            info: true,\n            displayStart: 0,\n            autoWidth: false,\n            language: {\n                processing: \"Buscando\",\n                loadingRecords: \"Cargando...\",\n                emptyTable: \"No hay registros\",\n                info: \"Mostrando _START_ a _END_ de _TOTAL_ registros\",\n                infoEmpty: \"Mostrando 0 a 0 de 0 registros\",\n                zeroRecords: \"No hay registros\",\n                search: \"\",\n                searchPlaceholder: \"Buscar...\",\n                infoFiltered: \" - filtrado para _MAX_ registros\",\n                paginate: {\n                    first: \"Primero\",\n                    last: \"Último\",\n                    next: \"Siguiente\",\n                    previous: \"Anterior\"\n                }\n            },\n            columns: [\n                {\n                    className: \"strong top\",\n                    data: \"corte\",\n                },\n                {\n                    className: \"strong red top xS\",\n                    data: null,\n                    render: function (data, type, row) {\n                        return row.inicio;\n                    }\n                },\n                {\n                    className: \"top xS\",\n                    data: null,\n                    render: function (data, type, row) {\n                        return row.fin;\n                    }\n                },\n                {\n                    className: 'text-center',\n                    data: null,\n                    render: function (data, type, row) {\n                        if (parseInt(row.active) == 0) {\n                            return `<span class=\"fa fa-circle\" style=\"color: #CCC; \" data-toggle=\"tooltip\" data-placement=\"top\" data-container=\"body\" data-original-title=\"Inactivo\"></span>`;\n                        } else {\n                            return `<span class=\"fa fa-circle\" style=\"color: #F99640; \" data-toggle=\"tooltip\" data-placement=\"top\" data-container=\"body\" data-original-title=\"Activo\"></span>`;\n                        }\n                    }\n                },\n                {\n                    data: null,\n                    className: 'text-center',\n                    searchable: false,\n                    render: function (data, type, row) {\n                        return `\n                            <a href=\"#\" class=\"btn btn-warning btn-xs btn-action btn-edit-periodo\" data-periodo-id=\"${row.id}\" data-periodo-status=\"${row.active}\" data-toggle=\"tooltip\" data-container=\"body\" data-placement=\"top\" data-title=\"Editar\"><i class=\"fa fa-pencil fa-fw\"></i></a>\n                            <a href=\"#\" class=\"btn btn-danger btn-xs btn-action btn-delete-periodo\" data-periodo-id=\"${row.id}\" data-toggle=\"tooltip\" data-container=\"body\" data-placement=\"top\" data-title=\"Eliminar\"><i class=\"fa fa-trash fa-fw\"></i></a>\n                        `;\n                    }\n                },\n            ]\n        })\n    }\n\n    var refresh = function (evt) {\n        dom.listTablePeriodos.ajax.reload();\n    }\n\n    var initFormFun = function () {}\n\n    var initializer = function () {\n        initTableListPeriodos();\n    }\n\n    return {\n        initializer: initializer,\n        refresh: refresh\n    }\n})()\n$(document).ready(function () {\n    Periodos.initializer();\n});","var FormNewPeriodo = (function(){\n\n    var el = {\n        modalAddPeriodo: '#modal-add-periodo',\n        btnNewPeriodo: '#btn-new-periodo',\n        formAddPeriodo: '#form-add-periodo',\n        inputCorte: '#corte',\n        inputInicio: '#inicio',\n        inputFin: '#fin',\n    };\n\n    var dom = {\n        modalAddPeriodo: $(el.modalAddPeriodo),\n        formAddPeriodo: $(el.formAddPeriodo),\n        inputCorte: $(el.inputCorte),\n        inputInicio: $(el.inputInicio),\n        inputFin: $(el.inputFin),\n    };\n\n    var validators = {\n        formAddPeriodo: function () {\n            return dom.formAddPeriodo.validate();\n        }\n    };\n\n    var events = {\n        showModal: function (evt) {\n            dom.modalAddPeriodo.modal({\n                show: true,\n                backdrop: 'static',\n                keyboard: false\n            })\n        },\n        hideModal: function (evt) {\n            dom.formAddPeriodo.trigger('reset');\n            Periodos.refresh();\n        }\n    };\n\n    var subscribeEvents = function () {\n        dom.modalAddPeriodo.on('showModal', events.showModal);\n        dom.modalAddPeriodo.on('hide.bs.modal', events.hideModal);\n    }\n\n    var validate = {\n        callback: function (form) {\n            Pace.track(function () {\n                var data = $(form).serialize();\n                $.ajax({\n                    url: '/admin/coordinador/periodo',\n                    data: data,\n                    type: 'POST',\n                    dataType: 'JSON',\n                })\n                .done(function(rs) {\n                    if (rs.response == 'ok') {\n                        noty({\n                            text: \"Se ha guardado correctamente...\",\n                            type: 'success',\n                            theme: \"relax\",\n                            timeout: 1500, // [integer|boolean] delay for closing event in milliseconds. Set false for sticky notifications\n                            progressBar: true, // [boolean] - displays a progress bar\n                            template: '<div class=\"noty_message\"><span class=\"fa fa-check\"></span> <span class=\"noty_text\"></span><div class=\"noty_close\"></div></div>',\n                            animation: {\n                                open: 'animated bounceInDown', // Animate.css class names\n                                close: 'animated bounceOutUp', // Animate.css class names\n                                easing: 'swing', // unavailable - no need\n                                speed: 500 // unavailable - no need\n                            }\n                        })\n                        // CLOSE\n                        dom.modalAddPeriodo.modal('hide');\n                    }\n                })\n                .fail(function(jqXHR) {\n                    var errors = [];\n                    if (jqXHR.responseJSON) {\n                        $.each(jqXHR.responseJSON, function (x, error) {\n                            $.each(error, function (x, o) {\n                                errors.push(o);\n                            })\n                        })\n\n                        if (errors.length > 0) {\n                            var html, title;\n                            if (errors.length > 1) {\n                                title = 'Han ocurrido los siguientes errores';\n                                html = '<ul>';\n                                $.each(errors, function (x, e) {\n                                    html += '<li style=\"list-style:square;text-align:left;margin-bottom:8px;color:red;\">'\n                                        + e;\n                                    + '</li>';\n                                })\n                                html += '</ul>';\n                            } else {\n                                title = '¡Acción denegada!';\n                                html = errors[0];\n                            }\n\n                            swal({\n                                title: title,\n                                text: html,\n                                html: true\n                            })\n                        }\n                    }\n                })\n            })\n        },\n        rules: {\n            corte: {\n                required: true\n            },\n            inicio: {\n                required: true,\n                validDate: true\n            },\n            fin: {\n                required: true,\n                validDate: true\n            }\n        }\n    }\n\n    var initFormFun = function () {\n        dom.inputCorte.inputmask('9999-9');\n        dom.inputInicio.datepicker({\n            language: 'es',\n            format: 'dd/mm/yyyy',\n            autoclose: true\n        });\n        dom.inputInicio.on('hide.bs.modal', function (e) {\n            e.stopPropagation();\n        })\n        dom.inputFin.datepicker({\n            language: 'es',\n            format: 'dd/mm/yyyy',\n            autoclose: true\n        });\n        dom.inputFin.on('hide.bs.modal', function (e) {\n            e.stopPropagation();\n        })\n    }\n\n    var initializer = function () {\n        subscribeEvents();\n        initFormFun();\n        Utils.initValidateForm(dom.formAddPeriodo[0], validate.callback, validate.rules);\n    }\n\n    return {\n        initializer: initializer,\n        el: el,\n        dom: dom,\n        events: events\n    }\n})()\n$(document).ready(function () {\n    FormNewPeriodo.initializer();\n});","var FormEditPeriodo = (function(){\n\n    var el = {\n        modalEditPeriodo: '#modal-edit-periodo',\n        formEditPeriodo: '#form-edit-periodo',\n        inputPeriodoId: '#periodo_id',\n        inputCorte: '#edit-corte',\n        inputInicio: '#edit-inicio',\n        inputFin: '#edit-fin',\n    };\n\n    var dom = {\n        modalEditPeriodo: $(el.modalEditPeriodo),\n        formEditPeriodo: $(el.formEditPeriodo),\n        inputPeriodoId: $(el.inputPeriodoId),\n        inputCorte: $(el.inputCorte),\n        inputInicio: $(el.inputInicio),\n        inputFin: $(el.inputFin),\n    };\n\n    var validators = {\n        formEditPeriodo: function () {\n            return dom.formEditPeriodo.validate();\n        }\n    };\n\n    var events = {\n        showModal: function (evt) {\n            dom.modalEditPeriodo.modal({\n                show: true,\n                backdrop: 'static',\n                keyboard: false\n            })\n        },\n        hideModal: function (evt) {\n            dom.formEditPeriodo.trigger('reset');\n        },\n        editPeriodo: function (evt, data) {\n            if (Object.keys(data).length > 0) {\n                dom.inputPeriodoId.val(data.id);\n                dom.inputCorte.val(data.corte);\n                dom.inputInicio.datepicker('update',data.inicio).change();\n                dom.inputFin.datepicker('update',data.fin).change();\n\n                // SHOW\n                dom.modalEditPeriodo.trigger('showModal');\n            }\n        }\n    };\n\n    var subscribeEvents = function () {\n        dom.modalEditPeriodo.on('showModal', events.showModal);\n        dom.modalEditPeriodo.on('hide.bs.modal', events.hideModal);\n        dom.formEditPeriodo.on('editPeriodo', events.editPeriodo);\n    }\n\n    var validate = {\n        callback: function (form) {\n            Pace.track(function () {\n                var data = $(form).serialize();\n                $.ajax({\n                    url: `/admin/coordinador/periodo/edit/${form.periodo_id.value}`,\n                    data: data,\n                    type: 'POST',\n                    dataType: 'JSON',\n                })\n                .done(function(rs) {\n                    if (rs.response == 'ok') {\n                        noty({\n                            text: \"Se ha actualizado correctamente...\",\n                            type: 'success',\n                            theme: \"relax\",\n                            timeout: 1500, // [integer|boolean] delay for closing event in milliseconds. Set false for sticky notifications\n                            progressBar: true, // [boolean] - displays a progress bar\n                            template: '<div class=\"noty_message\"><span class=\"fa fa-check\"></span> <span class=\"noty_text\"></span><div class=\"noty_close\"></div></div>',\n                            animation: {\n                                open: 'animated bounceInDown', // Animate.css class names\n                                close: 'animated bounceOutUp', // Animate.css class names\n                                easing: 'swing', // unavailable - no need\n                                speed: 500 // unavailable - no need\n                            }\n                        })\n                        // CLOSE\n                        dom.modalEditPeriodo.modal('hide');\n                        // REFRESH\n                        Periodos.refresh();\n                    }\n                })\n                .fail(function(jqXHR) {\n                    var errors = [];\n                    if (jqXHR.responseJSON) {\n                        $.each(jqXHR.responseJSON, function (x, error) {\n                            $.each(error, function (x, o) {\n                                errors.push(o);\n                            })\n                        })\n\n                        if (errors.length > 0) {\n                            var html, title;\n                            if (errors.length > 1) {\n                                title = 'Han ocurrido los siguientes errores';\n                                html = '<ul>';\n                                $.each(errors, function (x, e) {\n                                    html += '<li style=\"list-style:square;text-align:left;margin-bottom:8px;color:red;\">'\n                                        + e;\n                                    + '</li>';\n                                })\n                                html += '</ul>';\n                            } else {\n                                title = '¡Acción denegada!';\n                                html = errors[0];\n                            }\n\n                            swal({\n                                title: title,\n                                text: html,\n                                html: true\n                            })\n                        }\n                    }\n                })\n            })\n        },\n        rules: {\n            corte: {\n                required: true\n            },\n            inicio: {\n                required: true,\n                validDate: true\n            },\n            fin: {\n                required: true,\n                validDate: true\n            }\n        }\n    }\n\n    var initFormFun = function () {\n        dom.inputCorte.mask('9999-9');\n        dom.inputInicio.datepicker({\n            language: 'es',\n            format: 'dd/mm/yyyy',\n            autoclose: true\n        });\n        dom.inputInicio.on('hide.bs.modal', function (e) {\n            e.stopPropagation();\n        })\n        dom.inputFin.datepicker({\n            language: 'es',\n            format: 'dd/mm/yyyy',\n            autoclose: true\n        });\n        dom.inputFin.on('hide.bs.modal', function (e) {\n            e.stopPropagation();\n        })\n    }\n\n    var initializer = function () {\n        subscribeEvents();\n        initFormFun();\n        Utils.initValidateForm(dom.formEditPeriodo[0], validate.callback, validate.rules);\n    }\n\n    return {\n        initializer: initializer,\n        el: el,\n        dom: dom,\n        events: events\n    }\n})()\n$(document).ready(function () {\n    FormEditPeriodo.initializer();\n});"]}