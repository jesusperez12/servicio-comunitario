{"version":3,"sources":["projects_list.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"projects_list.js","sourcesContent":["$(document).ready(function() {\n    var table_list_projects = null;\n    Pace.track(function() {\n        table_list_projects = $(\"#table-list-projects\").DataTable({\n            ajax: '/admin/coordinador/project/all',\n            dom: '<\"row\"<\"col-sm-6 project-list-items\"f>>tp',\n            drawCallback: function(settings) {\n                var api = this.api();\n                $.each(api.rows().nodes(), function(x, tr){\n                    $(tr).find('[data-toggle=tooltip]').tooltip();\n                    // FUNCTION LOAD PROYECTO\n                    $(tr).find('.btn-load-proyecto').off('click').on('click', function(e) {\n                        e.preventDefault();\n                        var id = $(this).data('id');\n                        var tr_n = $(tr).closest('tr');\n                        var row = api.row( tr_n );\n                        if($(this).hasClass('active')) {\n                            row.child.hide(\"slow\");\n                            $(this).removeClass('active');\n                            return;\n                        }\n                        $(this).parent().find('a').removeClass('active');\n                        $(this).addClass('active');\n                        if(row.child.isShown()){\n                            row.child.hide(\"slow\");\n                        }\n                        row.child( show_view_proyecto(row.data()) ).show();\n                        tr_n.next().find(\".view_html\").slideDown(200);\n                    });\n                    // FUNCTION ASIGNAR USUARIO A PROYECTO\n                    $(tr).find('.btn-asign-user-proyecto').off('click').on('click', function(e) {\n                        e.preventDefault();\n                        var id = $(this).data('id');\n                        var tr_n = $(tr).closest('tr');\n                        var row = api.row( tr_n );\n                        if($(this).hasClass('active')) {\n                            row.child.hide(\"slow\");\n                            $(this).removeClass('active');\n                            return;\n                        }\n                        $(this).parent().find('a').removeClass('active');\n                        $(this).addClass('active');\n                        if ( row.child.isShown() ) {\n                            row.child.hide(\"slow\");\n                        }\n                        Pace.track(function() {\n                            $.ajax({\n                                url: \"/admin/coordinador/project/assign/user/to/\" + id,\n                                type: \"GET\",\n                                dataType: \"html\",\n                                success: function(data) {\n                                    Pace.track(function() {\n                                        $.ajax({\n                                            url: \"/admin/coordinador/project/assign/users/project/\" + id,\n                                            type: 'GET',\n                                            dataType: 'json',\n                                            success: function(json) {\n                                                var users = [];\n                                                $.each(json.users, function(x, user) {\n                                                    users.push(parseInt(user.id));\n                                                })\n                                                row.child( show_form_asign_proyecto(data) ).show();\n                                                tr_n.next().find(\".view_html\").slideDown(200);\n                                                \n                                                var options = tr_n.next().find('#usuarios').find('option');\n                                                $.each(options, function (y, input) {\n                                                    $.each(json.users, function (z, user) {\n                                                        if(parseInt($(input).val()) == parseInt(user.id)) {\n                                                            $(input).attr('disabled', true);\n                                                            $(input).attr('data-pup-id', user.pivot.id);\n                                                        } else {\n                                                            $(input).attr('disabled', false);\n                                                            $(input).removeAttr('data-pup-id');\n                                                        }\n                                                    })\n                                                    if (json.users.length == 0) {\n                                                        $(input).attr('disabled', false);\n                                                        $(input).removeAttr('data-pup-id');\n                                                    }\n                                                });\n\n                                                // SELECT PERIODOS\n                                                tr_n.next().find('#corte').select2({\n                                                    placeholder: 'Seleccione...',\n                                                });\n                                                tr_n.next().find('#corte').val(json.periodo.id).trigger('change');\n                                                // ON CHANGE EVENT\n                                                tr_n.next().find('#corte').on('change', function (evt) {\n                                                    var id = this.value;\n                                                    var proyecto_id = tr_n.next().find('[name=\"project_id\"]').val();\n                                                    Pace.track(function () {\n                                                        var rq = $.get(`/admin/coordinador/project/assign/users/project/${proyecto_id}/periodo/${id}`,\n                                                            function (data, textStatus, jqXHR) {\n                                                                var users = [];\n                                                                $.each(data.users, function (x, user) {\n                                                                    users.push(parseInt(user.id));\n                                                                })\n                                                                var options = tr_n.next().find('#usuarios').find('option');\n                                                                $.each(options, function (y, input) {\n                                                                    $.each(data.users, function (z, user) {\n                                                                        if (parseInt($(input).val()) == parseInt(user.id)) {\n                                                                            $(input).attr('disabled', true);\n                                                                            $(input).attr('data-pup-id', user.pivot.id);\n                                                                        } else {\n                                                                            $(input).attr('disabled', false);\n                                                                            $(input).removeAttr('data-pup-id');\n                                                                        }\n                                                                    })\n                                                                    if (data.users.length == 0) {\n                                                                        $(input).attr('disabled', false);\n                                                                        $(input).removeAttr('data-pup-id');\n                                                                    }\n                                                                });\n                                                                // LOAD USERS\n                                                                tr_n.next().find('#usuarios').select2('destroy');\n                                                                tr_n.next().find('#usuarios').select2({\n                                                                    placeholder: 'Seleccione...',\n                                                                });\n                                                                tr_n.next().find('#usuarios').val(users).trigger('change');\n\n                                                                if (data.users.length == 0) {\n                                                                    tr_n.next().find('#usuarios').select2('destroy');\n                                                                    tr_n.next().find('#usuarios').select2({\n                                                                        placeholder: 'Seleccione...',\n                                                                    });\n                                                                }\n                                                            },\n                                                            \"JSON\"\n                                                        );\n                                                    })\n                                                });\n\n                                                // SELECT USUARIOS\n                                                tr_n.next().find('#usuarios').select2({\n                                                    placeholder: 'Seleccione...',\n                                                });\n                                                tr_n.next().find('#usuarios').val(users).trigger('change');\n\n                                                // DELETING USER FROM PROJECT\n                                                tr_n.next().find('#usuarios').on('select2:unselecting', function(evt) {\n                                                    var select = this;\n                                                    var proyecto_id = tr_n.next().find('[name=\"project_id\"]').val();\n                                                    var periodo_id = tr_n.next().find('#corte').val();\n                                                    var pup_id = (evt.params.args.data.element.attributes.length > 1) ? $(evt.params.args.data.element).data('pup-id') : undefined;\n                                                    var user_id = (typeof evt.params != 'undefined') ? $(evt.params.args.data.element).val() : undefined;\n\n                                                    if (typeof pup_id !== 'undefined' && typeof pup_id !== 'string') {\n                                                        \n                                                        evt.preventDefault();\n\n                                                        swal({\n                                                            title: \"Estas seguro?\",\n                                                            text: \"¿ Realmente desea eliminarlo ?.<br><br>\",\n                                                            type: \"warning\",\n                                                            html:true,\n                                                            showCancelButton: true,\n                                                            confirmButtonColor: \"#DD6B55\",\n                                                            confirmButtonText: \"Si, eliminarlo!\",\n                                                            closeOnConfirm: false\n                                                        },\n                                                        function () {\n                                                            Pace.track(function () {\n                                                                // Ajax request\n                                                                $.ajax({\n                                                                    url: `/admin/coordinador/project/unassign/user/${user_id}/to/project/${proyecto_id}/pivot/${pup_id}/periodo/${periodo_id}`,\n                                                                    type: 'GET',\n                                                                    dataType: 'JSON',\n                                                                    beforeSend: function () {\n                                                                        swal.disableButtons();\n                                                                    },\n                                                                    success: function (json) {\n                                                                        if (json.response == \"ok\") {\n                                                                            swal(\"Eliminado!\", \"Se ha eliminado correctamente.\", \"success\");\n                                                                            evt.params.args.data.selected = false;\n                                                                            evt.params.args.data.disabled = false;\n                                                                            $(evt.params.args.data.element).attr('disabled', false);\n                                                                            $(evt.params.args.data.element).removeAttr('data-pup-id');\n                                                                            api.ajax.reload();\n                                                                        }\n                                                                    },\n                                                                    error: function (jqXHR, textStatus) {\n                                                                        var errors = [];\n                                                                        if (jqXHR.responseJSON) {\n                                                                            $.each(jqXHR.responseJSON, function (x, error) {\n                                                                                $.each(error, function (x, o) {\n                                                                                    errors.push(o);\n                                                                                })\n                                                                            })\n\n                                                                            if (errors.length > 0) {\n\n                                                                                swal({\n                                                                                    title: '¡Acción denegada!',\n                                                                                    text: errors[0],\n                                                                                    html: true\n                                                                                })\n\n                                                                            }\n                                                                        }\n                                                                    }\n                                                                })\n                                                            })\n                                                            // /.PACE\n                                                        },\n                                                        function(){\n                                                            tr_n.next().find('#usuarios').val(users).trigger('change');\n                                                        })\n                                                        // /.FUNCTION\n                                                        return true;\n                                                    }\n                                                });\n\n                                                tr_n.next().find(\".view_html\").find(\"#form-asign-user-project\").validate({\n                                                    submitHandler: function(form) {\n                                                        var mydata = $(form).serialize();\n                                                        Pace.track(function() {\n                                                            $.ajax({\n                                                                url: \"/admin/coordinador/project/assign/user/to/project\",\n                                                                data: mydata,\n                                                                type: 'POST',\n                                                                dataType: 'JSON',\n                                                                success: function(json) {\n                                                                    api.ajax.reload();\n                                                                    noty({\n                                                                        text: \"Se ha guardado correctamente...\",\n                                                                        type: 'success',\n                                                                        theme: \"relax\",\n                                                                        timeout: 1500, // [integer|boolean] delay for closing event in milliseconds. Set false for sticky notifications\n                                                                        progressBar: true, // [boolean] - displays a progress bar\n                                                                        template: '<div class=\"noty_message\"><span class=\"fa fa-check\"></span> <span class=\"noty_text\"></span><div class=\"noty_close\"></div></div>',\n                                                                        animation: {\n                                                                            open: 'animated bounceInDown', // Animate.css class names\n                                                                            close: 'animated bounceOutUp', // Animate.css class names\n                                                                            easing: 'swing', // unavailable - no need\n                                                                            speed: 500 // unavailable - no need\n                                                                        }\n                                                                    })\n                                                                },\n                                                                error: function(jqXHR) {\n                                                                    var errors = [];\n                                                                    if (jqXHR.responseJSON) {\n                                                                        $.each(jqXHR.responseJSON, function (x, error) {\n                                                                            $.each(error, function (x, o) {\n                                                                                errors.push(o);\n                                                                            })\n                                                                        })\n\n                                                                        if (errors.length > 0) {\n                                                                            var html, title;\n                                                                            if (errors.length > 1) {\n                                                                                title = 'Han ocurrido los siguientes errores';\n                                                                                html = '<ul>';\n                                                                                $.each(errors, function (x, e) {\n                                                                                    html += '<li style=\"list-style:square;text-align:left;margin-bottom:8px;color:red;\">'\n                                                                                        + e;\n                                                                                    + '</li>';\n                                                                                })\n                                                                                html += '</ul>';\n                                                                            } else {\n                                                                                title = '¡Acción denegada!';\n                                                                                html = errors[0];\n                                                                            }\n\n                                                                            swal({\n                                                                                title: title,\n                                                                                text: html,\n                                                                                html: true\n                                                                            })\n                                                                        }\n                                                                    }\n                                                                }\n                                                            })\n                                                        })\n                                                    }\n                                                });\n                                            }\n                                        })\n                                    })\n                                }\n                            })\n                        })\n                    });\n                })\n            },\n            initComplete: function (settings, json) {\n                // FILTRO\n                $(\".project-list-items\").find('[type=search]').removeClass(\"input-sm\")\n                    .css({\n                        \"width\": \"100%\",\n                        \"margin-left\": 0\n                    })\n                    .parents(\"label\").css({\n                        \"width\": \"100%\"\n                    });\n            },\n            searchDelay: 350,\n            ordering : false,\n            pagingType: \"simple_numbers\",\n            pageLength: 8,\n            lengthChange: false,\n            searching: true,\n            info: false,\n            displayStart: 0,\n            autoWidth: false,\n            language: {\n                loadingRecords: \"Cargando...\",\n                emptyTable:     \"No hay proyectos registrados por usted\",\n                info:           \"Mostrando _START_ a _END_ de _TOTAL_ registros\",\n                infoEmpty:      \"Mostrando 0 a 0 de 0 registros\",\n                zeroRecords:    \"No se encontraron proyectos...\",\n                search: \"\",\n                searchPlaceholder: \"Buscar en lista de proyectos...\",\n                infoFiltered: \" - filtrado para _MAX_ registros\",\n                paginate: {\n                    first:      \"Primero\",\n                    last:       \"Último\",\n                    next:       \"Siguiente\",\n                    previous:   \"Anterior\"\n                }\n            },\n            columns: [\n                {\n                    className: 'project',\n                    data: 'nombre_proyecto',\n                    render: function(data, type, row) {\n                        var project = \"<div class='p-title'>\"+ row.nombre_proyecto +\"</div>\"\n                        + \"<div class='p-autor'>\"\n                        + \"<strong>Autor: </strong>\" + row.user.firstname + \" \" + row.user.primary_lastname\n                        project += \"</div>\";\n                        return project;\n                    }\n                },\n                {\n                    className: 'p-actions',\n                    data: 'especialidad',\n                    render: function(data, type, row) {\n                        var actions = \"<a href='#!' class='btn btn-default btn-xs btn-action btn-load-proyecto' data-id='\"+ row.id +\"' data-toggle='tooltip' data-placement='top' data-title='Ver detalles del proyecto'><i class='fa fa-eye'></i></a>\"\n                        + \"<a href='#!' class='btn btn-default btn-xs btn-action btn-asign-user-proyecto' data-id='\"+ row.id +\"' data-toggle='tooltip' data-placement='top' data-title='Asignar profesor'><i class='fa fa-user'></i></a>\"\n                        + \"<a href='#!' class='btn btn-default btn-xs btn-action' data-toggle='tooltip' data-placement='top' data-title='Ver reportes de actividades'><i class='fa fa-list-alt'></i></a>\"\n                        + \"<a href='#!' class='btn btn-danger btn-xs btn-action' data-toggle='tooltip' data-placement='top' data-title='Enviar a la papelera'><i class='fa fa-trash'></i></a>\";\n                        return actions;\n                    }\n                },\n            ]\n        })\n    })\n\n    function show_view_proyecto(data) {\n        if(Object.keys(data).length > 0) {\n            var box = '<div class=\"view_html\" style=\"display: none;\">'\n                box += '<table class=\"table table-condensed table-bordered\" style=\"margin-bottom:-1px;\">'+\n                        '<tr class=\"view_info warning\">'+\n                            '<td colspan=\"2\" style=\"font-weight:bold;text-align:center;\">DETALLES DEL PROYECTO</td>'+\n                        '</tr>'+\n                        '<tr class=\"view_info\">'+\n                            '<td style=\"width:110px;font-weight:bold;text-align:right;\">Descripción</td>'+\n                            '<td>'+ data.descripcion +'</td>'+\n                        '</tr>'+\n                        '<tr class=\"view_info\">'+\n                            '<td style=\"font-weight:bold;text-align:right;\">Línea de acción</td>'+\n                            '<td>'+ data.linea_accion +'</td>'+\n                        '</tr>'+\n                        '<tr class=\"view_info\">'+\n                            '<td style=\"font-weight:bold;text-align:right;\">Fundamentación</td>'+\n                            '<td>'+ data.fundamentacion +'</td>'+\n                        '</tr>'+\n                        '<tr class=\"view_info\">'+\n                            '<td style=\"font-weight:bold;text-align:right;\">Propósito</td>'+\n                            '<td>'+ data.proposito +'</td>'+\n                        '</tr>'+\n                        '<tr class=\"view_info\">'+\n                            '<td style=\"font-weight:bold;text-align:right;\">Competencia</td>'+\n                            '<td>'+ data.competencia +'</td>'+\n                        '</tr>'+\n                        '<tr class=\"view_info\">'+\n                            '<td style=\"font-weight:bold;text-align:right;\">Metodología</td>'+\n                            '<td>'+ data.metodologia +'</td>'+\n                        '</tr>'+\n                        '<tr class=\"view_info\">'+\n                            '<td style=\"font-weight:bold;text-align:right;\">Referencias</td>'+\n                            '<td>'+\n                            '<ul>'; \n                            $.each(data.referencias, function(i, referencia) {\n                                box += '<li>'+referencia.referencia+'</li>';\n                            }); \n                            box += '</ul>'+\n                            '</td>'+\n                        '</tr>'+\n                        '</table>'+\n                    '</div>';\n            return box;\n        }else{\n            return;\n        }\n    }\n\n    function show_form_asign_proyecto(data) {\n        if(data) {\n            var box = '<div class=\"view_html\" style=\"display: none;\">'\n            + data\n            + '</div>';\n            return box;\n        }else{\n            return;\n        }\n    }\n\n    // Activate link\n    var url = $(\"#url-active\").data(\"url-active\");\n    global.url_active(url);\n})"]}