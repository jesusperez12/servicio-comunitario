{"version":3,"sources":["report_edit.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"report_edit.js","sourcesContent":["var Report = (function () {\n    var el = {\n        form: 'form-new-report',\n        fProyecto: 'proyecto',\n        fFecha: 'fecha',\n        fDuracion: 'duracion',\n        fDetalle: 'detalle',\n        btnArc: 'btn_arc',\n        btnAbc: 'btn_abc',\n        numericInput: 'numeric_input'\n    }\n    var tables = [];\n    var editor = CKEDITOR.instances;\n    var configEditor = '/assets/js/customs/ckeditor_add_project_config.js';\n\n    var dom = {\n        form: $(\"#\" + el.form),\n        fProyecto: $(\"#\" + el.fProyecto),\n        fFecha: $(\"#\" + el.fFecha),\n        fDuracion: $(\"#\" + el.fDuracion),\n        editor: CKEDITOR.instances,\n        btnArc: $(\"#\"+el.btnArc),\n        btnAbc: $(\"#\"+el.btnAbc),\n        numericInput: $(\".\"+el.numericInput)\n    }\n\n    var events = {\n        sendContentUpload: function(evt) {\n            var fileLoader = evt.data.fileLoader,\n            formData = new FormData(),\n            xhr = fileLoader.xhr;\n\n            xhr.open( 'POST', fileLoader.uploadUrl, true );\n            xhr.setRequestHeader( 'X-CSRF-TOKEN', $('meta[name=\"csrf-token\"]').attr('content') );\n            xhr.withCredentials = true;\n            formData.append( 'upload', fileLoader.file, fileLoader.fileName );\n            fileLoader.xhr.send( formData );\n\n            // Prevented the default behavior.\n            evt.stop();\n        },\n        addRecurso: function (evt) {\n            var elm = $($(\".recurso-element\")[0]).clone();\n            var btn_remove = `<div class=\"row recurso-element-cloned\">\n                <div class=\"col-xs-12\">\n                <button type=\"button\" class=\"close btn-remove-recurso\" style=\"font-size:12px;\"><i class=\"fa fa-remove\"></i></button>\n                </div>\n                </div>`;\n            $(btn_remove).prependTo(elm);\n            elm.find(\"input\").val(\"\");\n            var count = $(\".recurso-element\").find('.recursos').length;\n            elm.find(\"input\").attr(\"id\", \"recurso_\" + (count + 1));\n            elm.find('label.error').attr({\n                \"id\": \"recurso_\" + (count + 1) + \"-error\",\n                \"for\": \"recurso_\" + (count + 1)\n            })\n\n            $(elm).appendTo(\".box-recurso-element\");\n\n            // Action remove\n            $(\".btn-remove-recurso\").off('click').on('click', function (e) {\n                $(this).parents(\"div.recurso-element\").remove();\n            })\n            // Add validate\n            var resources = $(\".recursos\");\n            $.each(resources, function (x, input) {\n                $(input).rules('add', {\n                    required: true,\n                    lettersOnly: true\n                })\n            })\n\n            // Action remove\n            $(\".btn-remove-recurso\").off('click').on('click', function (e) {\n                var element = this;\n                var recurso_id = $(this).data('recurso-id');\n                if (typeof recurso_id != 'undefined') {\n                    swal({\n                        title: \"Estas seguro?\",\n                        text: \"¿ Realmente deseas eliminar este recurso ?.<br><br>\",\n                        type: \"warning\",\n                        html: true,\n                        showCancelButton: true,\n                        confirmButtonColor: \"#DD6B55\",\n                        confirmButtonText: \"Si, eliminar!\",\n                        closeOnConfirm: false\n                    },\n                        function () {\n                            Pace.track(function () {\n                                // Ajax request\n                                $.ajax({\n                                    url: '/admin/profesor/service/reporte/recurso/delete/' + recurso_id,\n                                    type: 'GET',\n                                    dataType: 'JSON',\n                                    beforeSend: function () {\n                                        swal.disableButtons();\n                                    },\n                                    success: function (json) {\n                                        if (json.response == \"ok\") {\n                                            swal(\"Eliminado!\", \"El recurso se ha eliminado con éxito.\", \"success\");\n                                            $(element).parents(\"div.recurso-element\").remove();\n                                        }\n                                    },\n                                    error: function (jqXHR) {\n                                        var errors = [];\n                                        if (jqXHR.responseJSON) {\n                                            $.each(jqXHR.responseJSON, function (x, error) {\n                                                $.each(error, function (x, o) {\n                                                    errors.push(o);\n                                                })\n                                            })\n\n                                            if (errors.length > 0) {\n                                                var html, title;\n                                                if (errors.length > 1) {\n                                                    title = 'Han ocurrido los siguientes errores';\n                                                    html = '<ul>';\n                                                    $.each(errors, function (x, e) {\n                                                        html += '<li style=\"list-style:square;text-align:left;margin-bottom:8px;color:red;\">'\n                                                            + e;\n                                                        + '</li>';\n                                                    })\n                                                    html += '</ul>';\n                                                } else {\n                                                    title = '¡Acción denegada!';\n                                                    html = errors[0];\n                                                }\n\n                                                swal({\n                                                    title: title,\n                                                    text: html,\n                                                    html: true\n                                                })\n                                            }\n                                        }\n                                    }\n                                })\n                            })\n                            // /.PACE\n                        })\n                    // /.FUNCTION\n                } else {\n                    $(this).parents(\"div.recurso-element\").remove();\n                }\n            })\n        },\n        addBeneficiario: function (evt) {\n            var elm = $($(\".beneficiario-element\")[0]).clone();\n            var btn_remove = `<div class=\"row beneficiario-element-cloned\">\n                <div class=\"col-xs-12\">\n                <button type=\"button\" class=\"close btn-remove-beneficiario\" style=\"font-size:12px;\"><i class=\"fa fa-remove\"></i></button>\n                </div>\n                </div>`;\n            $(btn_remove).prependTo(elm);\n            elm.find(\"input\").val(\"\");\n            var count = $(\".beneficiario-element\").find('.beneficiarios').length;\n            elm.find(\"input\").attr(\"id\", \"beneficiario_\" + (count + 1));\n            elm.find('label.error').attr({\n                \"id\": \"beneficiario_\" + (count + 1) + \"-error\",\n                \"for\": \"beneficiario_\" + (count + 1)\n            })\n\n            $(elm).appendTo(\".box-beneficiario-element\");\n\n            // Add validate\n            var resources = $(\".beneficiarios\");\n            $.each(resources, function (x, input) {\n                $(input).rules('add', {\n                    required: true,\n                    lettersOnly: true\n                })\n                $(input).numeric_input({\n                    decimal: '.',\n                    numberOfDecimals: null\n                });\n            })\n\n            // Action remove\n            $(\".btn-remove-beneficiario\").off('click').on('click', function (e) {\n                var element = this;\n                var beneficiario_id = $(this).data('beneficiario-id');\n                if (typeof beneficiario_id != 'undefined') {\n                    swal({\n                        title: \"Estas seguro?\",\n                        text: \"¿ Realmente deseas eliminar este beneficiario(s) ?.<br><br>\",\n                        type: \"warning\",\n                        html: true,\n                        showCancelButton: true,\n                        confirmButtonColor: \"#DD6B55\",\n                        confirmButtonText: \"Si, eliminar!\",\n                        closeOnConfirm: false\n                    },\n                        function () {\n                            Pace.track(function () {\n                                // Ajax request\n                                $.ajax({\n                                    url: '/admin/profesor/service/reporte/beneficiario/delete/' + beneficiario_id,\n                                    type: 'GET',\n                                    dataType: 'JSON',\n                                    beforeSend: function () {\n                                        swal.disableButtons();\n                                    },\n                                    success: function (json) {\n                                        if (json.response == \"ok\") {\n                                            swal(\"Eliminado!\", \"Se ha eliminado con éxito.\", \"success\");\n                                            $(element).parents(\"div.beneficiario-element\").remove();\n                                        }\n                                    },\n                                    error: function (jqXHR) {\n                                        var errors = [];\n                                        if (jqXHR.responseJSON) {\n                                            $.each(jqXHR.responseJSON, function (x, error) {\n                                                $.each(error, function (x, o) {\n                                                    errors.push(o);\n                                                })\n                                            })\n\n                                            if (errors.length > 0) {\n                                                var html, title;\n                                                if (errors.length > 1) {\n                                                    title = 'Han ocurrido los siguientes errores';\n                                                    html = '<ul>';\n                                                    $.each(errors, function (x, e) {\n                                                        html += '<li style=\"list-style:square;text-align:left;margin-bottom:8px;color:red;\">'\n                                                            + e;\n                                                        + '</li>';\n                                                    })\n                                                    html += '</ul>';\n                                                } else {\n                                                    title = '¡Acción denegada!';\n                                                    html = errors[0];\n                                                }\n\n                                                swal({\n                                                    title: title,\n                                                    text: html,\n                                                    html: true\n                                                })\n                                            }\n                                        }\n                                    }\n                                })\n                            })\n                            // /.PACE\n                        })\n                    // /.FUNCTION\n                } else {\n                    $(this).parents(\"div.beneficiario-element\").remove();\n                }\n            })\n        }\n    }\n\n    var suscribeEvents = function () {\n        editor.detalle.on( 'fileUploadRequest', events.sendContentUpload);\n        dom.btnArc.on('click', events.addRecurso);\n        dom.btnAbc.on('click', events.addBeneficiario);\n    }\n\n    var initFormEdit = function () {\n        var actividad = JSON.parse(dom.form.find(\"[name=data_actividad]\")[0].dataset.actividad);\n        dom.fProyecto.val(actividad.proyecto.id).trigger('change');\n        dom.fFecha.datepicker('setDate', moment(actividad.fecha).format('DD/MM/YYYY'));\n        dom.form.find(\"#direccion\").val(actividad.direccion);\n        dom.form.find(\"#actividad\").val(actividad.actividad);\n        dom.editor.detalle.setData(actividad.detalle);\n        dom.form.find('#impacto').val(actividad.impacto_gen);\n        \n        $.each(actividad.recursos, function (x, recurso) {\n            if (x == 0) {\n                dom.form.find(\"[name='tipo_recurso[]']\").val(recurso.tipo);\n                dom.form.find(\"[name='recursos[]']\").val(recurso.recurso);\n                dom.form.find(\"[name='recurso_id[]']\").val(recurso.id);\n            } else {\n                global.add_recurso(recurso);\n            }\n        })\n\n        $.each(actividad.beneficiarios, function (y, beneficiario) {\n            if (y == 0) {\n                dom.form.find(\"[name='tipo_beneficiario[]']\").val(beneficiario.genero);\n                dom.form.find(\"[name='beneficiarios[]']\").val(beneficiario.num_beneficiarios);\n                dom.form.find(\"[name='beneficiario_id[]']\").val(beneficiario.id);\n            } else {\n                global.add_beneficiario(beneficiario);\n            }\n        })\n\n        if(parseInt(actividad.hrs) == 1) {\n            dom.fDuracionComponent.update({\n                from: 0\n            })\n        } else if (parseInt(actividad.hrs) == 2) {\n            dom.fDuracionComponent.update({\n                from: 1\n            })\n        } else if(parseInt(actividad.hrs) == 3) {\n            dom.fDuracionComponent.update({\n                from: 2\n            })\n        } else if (parseInt(actividad.hrs) == 4) {\n            dom.fDuracionComponent.update({\n                from: 3\n            })\n        } else if (parseInt(actividad.hrs) == 5) {\n            dom.fDuracionComponent.update({\n                from: 4\n            })\n        } else if (parseInt(actividad.hrs) == 6) {\n            dom.fDuracionComponent.update({\n                from: 5\n            })\n        } else if (parseInt(actividad.hrs) == 7) {\n            dom.fDuracionComponent.update({\n                from: 6\n            })\n        } else if (parseInt(actividad.hrs) == 8) {\n            dom.fDuracionComponent.update({\n                from: 7\n            })\n        }\n    }\n\n    var initFnForm = function () {\n        dom.fProyecto.select2({\n            placeholder: 'Seleccione...',\n            // minimumResultsForSearch: 'Infinity'\n        });\n        dom.fFecha.datepicker({\n            language: 'es',\n            format: 'dd/mm/yyyy',\n            autoclose: true\n        });\n        dom.fFechaComponent = dom.fFecha.data('datepicker');\n\n        dom.fDuracion.ionRangeSlider({\n            grid: true,\n            from: 1,\n            postfix: 'h',\n            values: [\"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\"]\n        });\n\n        dom.fDuracionComponent = dom.fDuracion.data('ionRangeSlider');\n\n        dom.numericInput.numeric_input({\n            decimal: '.',\n            numberOfDecimals: null\n        });\n\n        $('div.alert').delay(5000).slideUp(300);\n    }\n\n    var assignProviderFun = function (group_id, provider_id, action) {\n        var data = JSON.parse($(\"#form-assign-providers\").find(\"#ls-groups-\" + group_id)[0].dataset['lsGroups-' + group_id]);\n        var uncheckedData = JSON.parse($(\"#form-assign-providers\").find(\"[name=providers_unchecked]\")[0].dataset.providersUnchecked);\n        if(action == 'add') {\n\n            data.push(provider_id);\n\n            var index = uncheckedData.map(function (v) {\n                return v;\n            }).indexOf(provider_id);\n\n            if (index > -1) {\n                uncheckedData.splice(index, 1);\n            }\n\n        }else{\n\n            var index = data.map(function (v) {\n                return v;\n            }).indexOf(provider_id);\n\n            if (index > -1) {\n                data.splice(index, 1);\n            }\n\n            uncheckedData.push(provider_id);\n        }\n\n        $(\"#form-assign-providers\").find(\"#ls-groups-\" + group_id)[0].dataset[\"lsGroups-\" + group_id] = JSON.stringify(data);\n        $(\"#form-assign-providers\").find(\"[name=providers_unchecked]\")[0].dataset.providersUnchecked = JSON.stringify(uncheckedData);\n    }\n\n    var assignNewProviderFun = function (group_id, provider_id, action) {\n        var data_new = JSON.parse($(\"#form-assign-providers\").find(\"#ls-groups-new-\" + group_id)[0].dataset['lsGroupsNew-' + group_id]);\n        if (action == 'add') {\n\n            data_new.push(provider_id);\n\n        } else {\n\n            var index = data_new.map(function (v) {\n                return v;\n            }).indexOf(provider_id);\n\n            if (index > -1) {\n                data_new.splice(index, 1);\n            }\n\n        }\n\n        $(\"#form-assign-providers\").find(\"#ls-groups-new-\" + group_id)[0].dataset[\"lsGroupsNew-\" + group_id] = JSON.stringify(data_new);\n    }\n\n    var sumHrsComunitarias = function (row, hrs, action) {\n        var cell = $(row[0].cells[2]);\n        var hrs_activity = $(\"#form-assign-providers\").find('#hrs_comunitarias').val();\n        if(action == 'add'){\n            if ($(row[0].cells[3]).find('input').hasClass('new')) {\n                cell.text(((parseFloat(hrs)) + (parseFloat(hrs_activity))).toFixed(1));\n            }else{\n                cell.text(parseFloat(hrs).toFixed(1));\n            }\n        }else{\n            if ($(row[0].cells[3]).find('input').hasClass('new')) {\n                cell.text(parseFloat(hrs).toFixed(1));\n            }else{\n                cell.text((Math.abs(parseFloat(hrs) - (parseFloat(hrs_activity))).toFixed(1) ));\n            }\n        }\n    }\n\n    var validate = {\n        callback: function (form) {\n            if (dom.editor.detalle.getData() != \"\") {\n                var actividad = dom.form.find(\"[name=data_actividad]\").data('actividad');\n                var periodo_id = dom.form.find('#proyecto').find(':selected').data('periodo-id');\n                var pup_id = dom.form.find('#proyecto').find(':selected').data('pup-id');\n                var data = dom.form.serialize() + \"&\" + $.param({ actividad_id: actividad.id, pup_id: pup_id, periodo_id: periodo_id, detalle: dom.editor.detalle.getData() });\n                var rq = $.ajax({\n                    url: \"/admin/profesor/service/reporte/update\",\n                    data: data,\n                    type: \"POST\",\n                    dataType: \"JSON\"\n                })\n                .done(function (rs) {\n                    if (rs.response == \"ok\") {\n                        dom.form.trigger(\"reset\");\n                        dom.editor.detalle.setData(null);\n                        dom.fFecha.datepicker('update','');\n                        dom.fDuracionComponent.reset();\n\n                        $(\"#form-assign-providers\").find('[name=pup_id]').val(rs.pup_id);\n                        $(\"#form-assign-providers\").find('#nombre-actividad').text(rs.actividad);\n                        $(\"#form-assign-providers\").find('#nombre-proyecto').text(rs.project.nombre_proyecto);\n                        $(\"#form-assign-providers\").find('#duracion-actividad').text(rs.duracion_actividad + ' hr(s)');\n                        $(\"#form-assign-providers\").find('#hrs_comunitarias').val(rs.duracion_actividad);\n                        \n                        noty({\n                            text: \"Se ha guardado correctamente...\",\n                            type: 'success',\n                            theme: \"relax\",\n                            timeout: 1500, // [integer|boolean] delay for closing event in milliseconds. Set false for sticky notifications\n                            progressBar: true, // [boolean] - displays a progress bar\n                            template: '<div class=\"noty_message\"><span class=\"fa fa-check\"></span> <span class=\"noty_text\"></span><div class=\"noty_close\"></div></div>',\n                            animation: {\n                                open: 'animated bounceInDown', // Animate.css class names\n                                close: 'animated bounceOutUp', // Animate.css class names\n                                easing: 'swing', // unavailable - no need\n                                speed: 500 // unavailable - no need\n                            }\n                        })\n                        var input = '';\n                        $.each(rs.groups, function (x, g) {\n                            var tab; \n                            if(x == 0) {\n                                tab = `<li class=\"my-tab-group-li active\"><a id=\"my-tab-group-${g.id}\" class=\"my-tab-group\" href=\"#tab_${g.id}\" data-toggle=\"tab\" aria-expanded=\"true\">Grupo ${g.grupo}</a></li>`;\n                            }else{\n                                tab = `<li class=\"my-tab-group-li\"><a id=\"my-tab-group-${g.id}\" class=\"my-tab-group\" href=\"#tab_${g.id}\" data-toggle=\"tab\" aria-expanded=\"true\">Grupo ${g.grupo}</a></li>`;\n                            }\n\n                            // ADD TABS\n                            $(\"#group-tabs\").append(tab);\n\n                            // ./LOAD LIST FOR PROVIDERS\n                            var headTable;\n                            if(x == 0) {\n                                headTable = `<div class=\"tab-pane content-table active\" id=\"tab_${g.id}\">\n                                            <table id=\"table-${g.id}\" class=\"table table-bordered table-prestadores-bordered table-condensed\" style=\"font-size: 12px;\">\n                                                <thead>\n                                                    <th style=\"width:115px;padding-right:5px;\">Nº de cédula</th>\n                                                    <th style=\"width:142px;\">Prestador de servicio</th>\n                                                    <th style=\"width:143px;\">Horas de servicio</th>\n                                                    <th style=\"width:35px;\"></th>\n                                                </thead>\n                                            </table>\n                                            </div>`;\n                            }else{\n                                headTable = `<div class=\"tab-pane content-table\" id=\"tab_${g.id}\">\n                                            <table id=\"table-${g.id}\" class=\"table table-bordered table-prestadores-bordered table-condensed\" style=\"font-size: 12px;\">\n                                                <thead>\n                                                    <th style=\"width:115px;padding-right:5px;\">Nº de cédula</th>\n                                                    <th style=\"width:142px;\">Prestador de servicio</th>\n                                                    <th style=\"width:143px;\">Horas de servicio</th>\n                                                    <th style=\"width:35px;\"></th>\n                                                </thead>\n                                            </table>\n                                            </div>`;\n                            }\n\n                            $(\"#group-tabs-content\").append(headTable);\n\n                            // ./SET INPUT HIDDEN DATA LIST GROUPS\n                            input += `<input type=\"hidden\" class=\"ls-groups\" id=\"ls-groups-${g.id}\" data-ls-groups-${g.id}=\"[]\">\n                                      <input type=\"hidden\" class=\"ls-groups-new\" id=\"ls-groups-new-${g.id}\" data-ls-groups-new-${g.id}=\"[]\">`;\n\n                            // ./REQUEST LIST PROVIDERS\n                            if(x == 0) {\n                                Pace.track(function () {\n                                    tables[x] = $(\"#table-\" + g.id).DataTable({\n                                        ajax: '/admin/profesor/service/myprojects/providers/group/' + g.id,\n                                        drawCallback: function (settings) {\n                                            var api_ = this.api();\n                                            $.each(api_.rows().nodes(), function (x, tr) {\n                                                // FUNCTION ASSIGN PRESTADOR\n                                                $(tr).find('.assign_provider_check').on('click', function () {\n                                                    var row = $(this).parents('tr');\n                                                    var groupId = $(this).data('group-id');\n                                                    var providerId = $(this).data('provider-id');\n                                                    var hrsComunitarias = $(this).data('hrs-comunitarias');\n                                                    if($(this).is(\":checked\")) {\n                                                        if($(this).hasClass('new')) {\n                                                            assignNewProviderFun(groupId, providerId, 'add');\n                                                        }else{\n                                                            assignProviderFun(groupId, providerId, 'add');\n                                                        }\n                                                        sumHrsComunitarias(row, hrsComunitarias, 'add');\n                                                    }else{\n                                                        if ($(this).hasClass('new')) {\n                                                            assignNewProviderFun(groupId, providerId, 'remove');\n                                                        } else {\n                                                            assignProviderFun(groupId, providerId, 'remove');\n                                                        }\n                                                        sumHrsComunitarias(row, hrsComunitarias, 'remove');\n                                                    }\n                                                });\n                                            })\n                                        },\n                                        initComplete: function (settings) {\n                                            var api_ = this.api();\n                                            $.each(api_.rows().nodes(), function (x, tr) {\n                                                // FUNCTION UPDATE PRESTADOR\n                                                var row = $(tr);\n                                                var groupId = $(tr).find('.assign_provider_check').data('group-id');\n                                                var providerId = $(tr).find('.assign_provider_check').data('provider-id');\n                                                var hrsComunitarias = $(tr).find('.assign_provider_check').data('hrs-comunitarias');\n                                                if(!rs.prestadores.length) {\n                                                    $(tr).find('.assign_provider_check').addClass(\"new\");\n                                                }\n                                                $.each(rs.prestadores, function (s, p) {\n                                                    if (parseInt(p.grupo_id) == groupId) {\n                                                        if(parseInt(p.id) == providerId) {\n                                                            $(tr).find('.assign_provider_check').attr(\"checked\", true);\n                                                            $(tr).find('.assign_provider_check').removeClass(\"new\");\n                                                            return false;\n                                                        } else {\n                                                            $(tr).find('.assign_provider_check').addClass(\"new\");\n                                                        }\n                                                    }\n                                                })\n                                            })\n                                        },\n                                        ordering: false,\n                                        paging: false,\n                                        pagingType: \"simple_numbers\",\n                                        pageLength: 10,\n                                        lengthChange: false,\n                                        searching: false,\n                                        info: false,\n                                        displayStart: 0,\n                                        autoWidth: false,\n                                        language: {\n                                            loadingRecords: \"Cargando...\",\n                                            emptyTable: \"No se han registrado prestadores de servicio en este proyecto\",\n                                            info: \"Mostrando _START_ a _END_ de _TOTAL_ registros\",\n                                            infoEmpty: \"Mostrando 0 a 0 de 0 registros\",\n                                            zeroRecords: \"No hay prestadores de servicio registrados...\",\n                                            search: \"\",\n                                            searchPlaceholder: \"Buscar en lista de roles...\",\n                                            infoFiltered: \" - filtrado para _MAX_ registros\",\n                                            paginate: {\n                                                first: \"Primero\",\n                                                last: \"Último\",\n                                                next: \"Siguiente\",\n                                                previous: \"Anterior\"\n                                            }\n                                        },\n                                        columns: [\n                                            { data: 'ci' },\n                                            {\n                                                data: null,\n                                                render: function (data, type, row) {\n                                                    return `${row.firstname} ${(row.middlename) ? row.middlename : ''} ${row.primary_lastname} ${(row.second_lastname) ? row.second_lastname : ''}`;\n                                                }\n                                            },\n                                            {\n                                                data: 'hrs_comunitarias'\n                                            },\n                                            {\n                                                className: 'box-actions-center',\n                                                data: null,\n                                                render: function (data, type, row) {\n                                                    return `<input data-hrs-comunitarias=\"${row.hrs_comunitarias}\" data-provider-id=\"${row.id}\" data-group-id=\"${g.id}\" type=\"checkbox\" name=\"assign_provider_check\" class=\"assign_provider_check\">`;\n                                                }\n                                            }\n                                        ]\n                                    });\n                                })\n                            }else{\n                                $(\"#my-tab-group-\" + g.id).one('click', function () {\n                                    Pace.track(function () {\n                                        tables[x] = $(\"#table-\" + g.id).DataTable({\n                                            ajax: '/admin/profesor/service/myprojects/providers/group/' + g.id,\n                                            drawCallback: function (settings) {\n                                                var api_ = this.api();\n                                                $.each(api_.rows().nodes(), function (x, tr) {\n                                                    // FUNCTION ASSIGN PRESTADOR\n                                                    $(tr).find('.assign_provider_check').on('click', function () {\n                                                        var row = $(this).parents('tr');\n                                                        var groupId = $(this).data('group-id');\n                                                        var providerId = $(this).data('provider-id');\n                                                        var hrsComunitarias = $(this).data('hrs-comunitarias');\n                                                        if ($(this).is(\":checked\")) {\n                                                            if ($(this).hasClass('new')) {\n                                                                assignNewProviderFun(groupId, providerId, 'add');\n                                                            } else {\n                                                                assignProviderFun(groupId, providerId, 'add');\n                                                            }\n                                                            sumHrsComunitarias(row, hrsComunitarias, 'add');\n                                                        } else {\n                                                            if ($(this).hasClass('new')) {\n                                                                assignNewProviderFun(groupId, providerId, 'remove');\n                                                            } else {\n                                                                assignProviderFun(groupId, providerId, 'remove');\n                                                            }\n                                                            sumHrsComunitarias(row, hrsComunitarias, 'remove');\n                                                        }\n                                                    });\n                                                })\n                                            },\n                                            initComplete: function (settings) {\n                                                var api_ = this.api();\n                                                $.each(api_.rows().nodes(), function (x, tr) {\n                                                    // FUNCTION UPDATE PRESTADOR\n                                                    var row = $(tr);\n                                                    var groupId = $(tr).find('.assign_provider_check').data('group-id');\n                                                    var providerId = $(tr).find('.assign_provider_check').data('provider-id');\n                                                    var hrsComunitarias = $(tr).find('.assign_provider_check').data('hrs-comunitarias');\n\n                                                    if (!rs.prestadores.length) {\n                                                        $(tr).find('.assign_provider_check').addClass(\"new\");\n                                                    }\n\n                                                    $.each(rs.prestadores, function (s, p) {\n                                                        if (parseInt(p.grupo_id) == groupId) {\n                                                            if (parseInt(p.id) == providerId) {\n                                                                $(tr).find('.assign_provider_check').attr(\"checked\", true);\n                                                                $(tr).find('.assign_provider_check').removeClass(\"new\");\n                                                                return false;\n                                                            } else {\n                                                                $(tr).find('.assign_provider_check').addClass(\"new\");\n                                                            }\n                                                        } else {\n                                                            $(tr).find('.assign_provider_check').addClass(\"new\");\n                                                        } \n                                                    })\n                                                })\n                                            },\n                                            ordering: false,\n                                            paging: false,\n                                            pagingType: \"simple_numbers\",\n                                            pageLength: 8,\n                                            lengthChange: false,\n                                            searching: false,\n                                            info: false,\n                                            displayStart: 0,\n                                            autoWidth: false,\n                                            language: {\n                                                loadingRecords: \"Cargando...\",\n                                                emptyTable: \"No se han registrado prestadores de servicio en este proyecto\",\n                                                info: \"Mostrando _START_ a _END_ de _TOTAL_ registros\",\n                                                infoEmpty: \"Mostrando 0 a 0 de 0 registros\",\n                                                zeroRecords: \"No hay prestadores de servicio registrados...\",\n                                                search: \"\",\n                                                searchPlaceholder: \"Buscar en lista de roles...\",\n                                                infoFiltered: \" - filtrado para _MAX_ registros\",\n                                                paginate: {\n                                                    first: \"Primero\",\n                                                    last: \"Último\",\n                                                    next: \"Siguiente\",\n                                                    previous: \"Anterior\"\n                                                }\n                                            },\n                                            columns: [\n                                                { data: 'ci' },\n                                                {\n                                                    data: null,\n                                                    render: function (data, type, row) {\n                                                        return `${row.firstname} ${(row.middlename) ? row.middlename : ''} ${row.primary_lastname} ${(row.second_lastname) ? row.second_lastname : ''}`;\n                                                    }\n                                                },\n                                                {\n                                                    data: 'hrs_comunitarias'\n                                                },\n                                                {\n                                                    className: 'box-actions-center',\n                                                    data: null,\n                                                    render: function (data, type, row) {\n                                                        return `<input data-hrs-comunitarias=\"${row.hrs_comunitarias}\" data-provider-id=\"${row.id}\" data-group-id=\"${g.id}\" type=\"checkbox\" name=\"assign_provider_check\" class=\"assign_provider_check\">`;\n                                                    }\n                                                }\n                                            ]\n                                        });\n                                    })\n                                })\n                            }\n                        })\n\n                        // ./SET INPUT HIDDEN DATA LIST GROUPS\n                        $(\"#data-list-group\").html(input);\n                        // ./SET IDS PRIVIDERS\n                        $.each(rs.prestadores, function (k, p) {\n                            assignProviderFun(p.grupo_id, p.id, 'add');\n                        });\n\n                        // ./SHOW MODAL\n                        $(\"#assignProvidersToActivity\").modal({\n                            show: true,\n                            backdrop: 'static',\n                            keyboard: false\n                        })\n\n                        $(\"#assignProvidersToActivity\").on('hide.bs.modal', function(){\n                            $(\"#group-tabs, #group-tabs-content, #data-list-group\").html(\"\");\n                            window.location = '/admin/profesor/service/reports';\n                        })\n\n                        // ./SAVE ASSIGN PROVIDERS TO ACTIVITY\n                        $(\"#form-assign-providers\").validate({\n                            submitHandler: function(form) {\n                                $(\"#assignProvidersToActivity\").find(\"#btn-save-assing-provider\").attr('disabled', true);\n                                var lsGroups = $(form).find(\".ls-groups\");\n                                var lsGroupsNew = $(form).find(\".ls-groups-new\");\n                                var lProvidersUnchecked = $(form).find(\"[name=providers_unchecked]\")[0].dataset.providersUnchecked;\n                                var pup_id = $(form).find(\"[name=pup_id]\").val();\n                                var actividadOld = dom.form.find(\"[name=data_actividad]\")[0].dataset.actividad;\n                                var providersList = [];\n                                var providersListNew = [];\n                                $.each(lsGroups, function(k, entry){\n                                    var group = $(entry).attr('id').split('-');\n                                    var providers = JSON.parse($(entry)[0].dataset['lsGroups-' + group[2]]);\n                                    providersList.push({pup_id: pup_id, group_id: group[2], providers: providers});\n                                })\n                                $.each(lsGroupsNew, function(l, element){\n                                    var group = $(element).attr('id').split('-');\n                                    var providers = JSON.parse($(element)[0].dataset['lsGroupsNew-' + group[3]]);\n                                    providersListNew.push({pup_id: pup_id, group_id: group[3], providers: providers});\n                                })  \n                                \n                                var providersListReq = $.ajax({\n                                    url: \"/admin/profesor/service/reporte/update/assign/providers\",\n                                    data: {\n                                        pup_id: pup_id,\n                                        actividadOld: actividadOld,\n                                        dataProvidersUnchecked: lProvidersUnchecked,\n                                        dataProvidersList: providersList,\n                                        dataProvidersListNew: providersListNew\n                                    },\n                                    type: \"POST\",\n                                    dataType: \"JSON\"\n                                })\n                                .done(function (rs) {\n                                    if (rs.response == 'ok') {\n                                        noty({\n                                            text: \"Se ha guardado correctamente...\",\n                                            type: 'success',\n                                            theme: \"relax\",\n                                            timeout: 1500, // [integer|boolean] delay for closing event in milliseconds. Set false for sticky notifications\n                                            progressBar: true, // [boolean] - displays a progress bar\n                                            template: '<div class=\"noty_message\"><span class=\"fa fa-check\"></span> <span class=\"noty_text\"></span><div class=\"noty_close\"></div></div>',\n                                            animation: {\n                                                open: 'animated bounceInDown', // Animate.css class names\n                                                close: 'animated bounceOutUp', // Animate.css class names\n                                                easing: 'swing', // unavailable - no need\n                                                speed: 500 // unavailable - no need\n                                            }\n                                        })\n\n                                        setTimeout(function(){\n                                            window.location = rs.url\n                                        }, 1000);\n\n                                    }else{\n                                        setTimeout(function(){\n                                            window.location = rs.url\n                                        }, 1000);\n                                    }\n                                }) \n                                .fail(function (jqXHR, textStatus) {\n                                    console.log(jqXHR);\n                                    console.log(textStatus);\n                                    $(\"#assignProvidersToActivity\").find(\"#btn-save-assing-provider\").attr('disabled', false);\n                                })\n                            }\n                        })\n                    }\n                })\n                .fail(function (jqXHR, textStatus) {\n                    var errors = [];\n                    if (jqXHR.responseJSON) {\n                        $.each(jqXHR.responseJSON, function (x, error) {\n                            $.each(error, function (x, o) {\n                                errors.push(o);\n                            })\n                        })\n\n                        if (errors.length > 0) {\n                            var html, title;\n                            if(errors.length > 1) {\n                                title = 'Han ocurrido los siguientes errores';\n                                html = '<ul>';\n                                $.each(errors, function (x, e) {\n                                    html += '<li style=\"list-style:square;text-align:left;margin-bottom:8px;color:red;\">'\n                                        + e;\n                                    + '</li>';\n                                })\n                                html += '</ul>';\n                            }else{\n                                title = '¡Acción denegada!';\n                                html = errors[0];\n                            }\n\n                            swal({\n                                title: title,\n                                text: html,\n                                html: true\n                            })\n                        }\n                    }\n                })\n            }else{\n                noty({\n                    text: \"El detalle de la actividad es obligatorio.\",\n                    type: 'error',\n                    theme: \"relax\",\n                    timeout: 2000, // [integer|boolean] delay for closing event in milliseconds. Set false for sticky notifications\n                    progressBar: true, // [boolean] - displays a progress bar\n                    template: '<div class=\"noty_message\"><span class=\"fa fa-check\"></span> <span class=\"noty_text\"></span><div class=\"noty_close\"></div></div>',\n                    animation: {\n                        open: 'animated bounceInDown', // Animate.css class names\n                        close: 'animated bounceOutUp', // Animate.css class names\n                        easing: 'swing', // unavailable - no need\n                        speed: 500 // unavailable - no need\n                    }\n                })\n            }\n        },\n        rules: {\n            proyecto: {\n                required: true\n            },\n            fecha: {\n                required: true,\n                validDate: true\n            },\n            direccion: {\n                required: true,\n                maxlength: 150\n            },\n            actividad: {\n                required: true,\n                maxlength: 255\n            },\n            duracion: {\n                required: true,\n                number: true\n            },\n            impacto: {\n                required: true,\n                maxlength: 255\n            },\n            'recursos[]': {\n                required: true\n            },\n            'tipo_recurso[]': {\n                required: true\n            },\n            'beneficiarios[]': {\n                required: true\n            },\n            'tipo_beneficiario[]': {\n                required: true\n            },\n        }\n    }\n\n    var initEditor = function () {\n        CKEDITOR.replace(el.fDetalle, { customConfig: configEditor });\n    }\n\n    var initializer= function () {\n        initFnForm();\n        initEditor();\n        suscribeEvents();\n        Utils.initValidateForm(dom.form[0], validate.callback, validate.rules);\n        initFormEdit();\n    }\n\n    return {\n        initializer: initializer\n    }\n\n})()\n\n$(document).ready(function() {\n    Report.initializer();\n})"]}